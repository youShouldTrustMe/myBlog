<!doctype html>
<html
  lang="zh-cn" 
  
    data-theme-mode="auto"
  
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  CAN | TrustMe
</title>
<meta
  name="description"
  content="你要信我啊"
/>










<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\",\"count\":50,\"enable\":false},\"fail\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"success\":\"复制成功(*^▽^*)\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":\"本文最后更新于 {time}，请注意文中内容可能已经发生变化。\"}}");
</script>











  
  
  
    
  

  
  
  
    
  

  
    

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />



  






 <link rel="stylesheet" href="/css/loader.css" />




  <meta property="og:type" content="website" />
  <meta property="og:title" content="CAN | TrustMe" />
  <meta
    property="og:description"
    content="你要信我啊"
  />
  <meta property="og:url" content="http://localhost:1313/post/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/can/" />
  <meta
    property="og:site_name"
    content="TruestMe&#39;s Blog"
  />
  <meta
    property="og:image"
    content="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_50_55_202501150950487.png"
  />
  <meta property="article:author" content="TrustMe" />
  <meta property="article:published_time" content="2025-03-01T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2025-03-01T00:00:00&#43;00:00" />
  
    <meta property="article:tag" content="通信协议" />
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_50_55_202501150950487.png" />
  
  
  
  
  




<link rel="shortcut icon" href="/favicon.ico">







 <link rel="stylesheet" href="/css/main.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />





  </head>
  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <img src="/images/loadImage.png" alt="loading" />
        
      </div>
      <div class="loading-word">赖东东得加载一会....</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>


<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe61b;
          
        </div>
        <a class="main-nav-link" href="/">首页</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe623;
          
        </div>
        <a class="main-nav-link" href="/archives">归档</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe621;
          
        </div>
        <a class="main-nav-link" href="/about">关于</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe639;
          
        </div>
        <a class="main-nav-link" href="/friend">友链</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
    <picture></picture>
      <img fetchpriority="high" src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_50_55_202501150950487.png" alt="CAN">
    
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">CAN</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <div id="content"
          class="sidebar-left"
            >
          <aside id="sidebar">
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#数据帧">数据帧</a></li>
    <li><a href="#数据帧的各部分用途简介">数据帧的各部分用途简介</a></li>
    <li><a href="#遥控帧">遥控帧</a></li>
    <li><a href="#错误帧">错误帧</a></li>
    <li><a href="#过载帧">过载帧</a></li>
    <li><a href="#帧间隔">帧间隔</a></li>
  </ul>

  <ul>
    <li><a href="#接收方数据采样遇到的问题">接收方数据采样遇到的问题</a></li>
  </ul>

  <ul>
    <li><a href="#硬同步">硬同步</a></li>
    <li><a href="#再同步">再同步</a></li>
    <li><a href="#波特率计算">波特率计算</a></li>
  </ul>

  <ul>
    <li><a href="#多设备同时发送所遇到的问题">多设备同时发送所遇到的问题</a></li>
    <li><a href="#问题1解决方案-先占先得">问题1解决方案-先占先得</a></li>
    <li><a href="#问题2解决方案-非破坏性仲裁">问题2解决方案-非破坏性仲裁</a>
      <ul>
        <li><a href="#非破坏性仲裁过程">非破坏性仲裁过程</a></li>
      </ul>
    </li>
    <li><a href="#数据帧和遥控帧的优先级">数据帧和遥控帧的优先级</a></li>
    <li><a href="#标准格式和扩展格式的优先级">标准格式和扩展格式的优先级</a></li>
  </ul>

  <ul>
    <li><a href="#错误类型">错误类型</a></li>
    <li><a href="#错误状态">错误状态</a></li>
    <li><a href="#错误计数器">错误计数器</a></li>
  </ul>

  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#网络拓扑结构">网络拓扑结构</a></li>
    <li><a href="#内部设计">内部设计</a></li>
    <li><a href="#基本过程">基本过程</a>
      <ul>
        <li><a href="#发送过程">发送过程</a></li>
        <li><a href="#接收过程">接收过程</a></li>
        <li><a href="#过滤器">过滤器</a></li>
      </ul>
    </li>
    <li><a href="#测试模式">测试模式</a></li>
    <li><a href="#工作模式">工作模式</a></li>
    <li><a href="#位时间特性">位时间特性</a></li>
    <li><a href="#中断">中断</a></li>
    <li><a href="#时间触发通信">时间触发通信</a></li>
    <li><a href="#错误处理和离线恢复">错误处理和离线恢复</a></li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="TrustMe"
    class="lazyload"
  />
  <div class="sidebar-author-name">TrustMe</div>
  <div class="sidebar-description">你要信我啊</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    
    <div class="sidebar-state-number">60</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-bilibili sidebar-social-icon">
      <a
        href="https://space.bilibili.com/yourname"
        itemprop="url"
        target="_blank"
        aria-label="bilibili"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/youShouldTrustMe"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="首页"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe61b;
        
      </div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="归档"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe623;
        
      </div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="关于"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="友链"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe639;
        
      </div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>

        </div>
      

      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  <div class="sidebar-widget">
    
  </div>
</aside>

          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <span
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2025-03-01 00:00:00 &#43;0000 UTC" itemprop="datePublished"
      >2025-03-01</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-03-01</time
    >
  </span>
</div>

      <div class="article-category">
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="can简介">
<a class="header-anchor" href="#can%e7%ae%80%e4%bb%8b"></a>
CAN简介
</h1><ol>
<li>
<p>CAN总线（Controller Area Network Bus）控制器局域网总线</p>
</li>
<li>
<p>CAN总线是由BOSCH公司开发的一种简洁易用、传输速度快、易扩展、可靠性高的串行通信总线，广泛应用于汽车、嵌入式、工业控制等领域</p>
</li>
<li>
<p>CAN总线特征：</p>
<ul>
<li>
<p>两根通信线（CAN_H、CAN_L），线路少，无需共地</p>
</li>
<li>
<p>差分信号通信，抗干扰能力强</p>
</li>
<li>
<p>高速CAN（ISO11898）：125k~1Mbps, &lt;40m</p>
</li>
<li>
<p>低速CAN（ISO11519）：10k~125kbps, &lt;1km</p>
</li>
<li>
<p>异步，无需时钟线，通信速率由设备各自约定</p>
</li>
<li>
<p>半双工，可挂载多设备，多设备同时发送数据时通过仲裁判断先后顺序</p>
</li>
<li>
<p>11位/29位报文ID，用于区分消息功能，同时决定优先级</p>
</li>
<li>
<p>可配置1~8字节的有效载荷</p>
</li>
<li>
<p>可实现广播式和请求式两种传输方式</p>
</li>
<li>
<p>应答、CRC校验、位填充、位同步、错误处理等特性</p>
</li>
</ul>
</li>
</ol>
<h1 id="主流通信协议对比">
<a class="header-anchor" href="#%e4%b8%bb%e6%b5%81%e9%80%9a%e4%bf%a1%e5%8d%8f%e8%ae%ae%e5%af%b9%e6%af%94"></a>
主流通信协议对比
</h1><table>
  <thead>
      <tr>
          <th><strong>名称</strong></th>
          <th><strong>引脚</strong></th>
          <th><strong>双工</strong></th>
          <th><strong>时钟</strong></th>
          <th><strong>电平</strong></th>
          <th><strong>设备</strong></th>
          <th><strong>应用场景</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>UART</td>
          <td>TX、RX</td>
          <td>全双工</td>
          <td>异步</td>
          <td>单端</td>
          <td>点对点</td>
          <td>两个设备互相通信</td>
      </tr>
      <tr>
          <td>I2C</td>
          <td>SCL、SDA</td>
          <td>半双工</td>
          <td>同步</td>
          <td>单端</td>
          <td>多设备</td>
          <td>一个主控外挂多个模块</td>
      </tr>
      <tr>
          <td>SPI</td>
          <td>SCK、MOSI、MISO、SS</td>
          <td>全双工</td>
          <td>同步</td>
          <td>单端</td>
          <td>多设备</td>
          <td>一个主控外挂多个模块（高速）</td>
      </tr>
      <tr>
          <td>CAN</td>
          <td>CAN_H、CAN_L</td>
          <td>半双工</td>
          <td>异步</td>
          <td>差分</td>
          <td>多设备</td>
          <td>多个主控互相通信</td>
      </tr>
  </tbody>
</table>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_50_55_202501150950487.png" alt="不同协议的对比"></p>
<h1 id="can硬件电路">
<a class="header-anchor" href="#can%e7%a1%ac%e4%bb%b6%e7%94%b5%e8%b7%af"></a>
CAN硬件电路
</h1><ul>
<li>
<p>每个设备通过CAN收发器挂载在CAN总线网络上</p>
</li>
<li>
<p>CAN控制器引出的TX和RX与CAN收发器相连，CAN收发器引出的CAN_H和CAN_L分别与总线的CAN_H和CAN_L相连</p>
</li>
<li>
<p>高速CAN使用闭环网络，CAN_H和CAN_L两端添加120Ω的终端电阻，增加电阻的作用有两个，一是防止回波反射，二是在没有设备进行操作的时候，将两根差分线的电压收紧，使其电压一致</p>
</li>
<li>
<p>低速CAN使用开环网络，CAN_H和CAN_L其中一端添加2.2kΩ的终端电阻</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_52_5_202501150952445.png" alt="CAN硬件电路"></p>
</li>
</ul>
<h1 id="can的电平标准">
<a class="header-anchor" href="#can%e7%9a%84%e7%94%b5%e5%b9%b3%e6%a0%87%e5%87%86"></a>
CAN的电平标准
</h1><ul>
<li>CAN总线采用差分信号，即两线电压差（VCAN_H-VCAN_L）传输数据位</li>
<li>高速CAN规定：</li>
</ul>
<p>​	电压差为0V时表示逻辑1（隐性电平，总线收紧状态）</p>
<p>​	电压差为2V时表示逻辑0（显性电平，总线张开状态）</p>
<ul>
<li>低速CAN规定：（电压有压降，所以拉大了两个信号线的电压差）</li>
</ul>
<p>​	电压差为-1.5V时表示逻辑1（隐性电平）</p>
<p>​	 电压差为3V时表示逻辑0（显性电平）</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_54_57_202501150954243.png" alt="CAN电平标准"></p>
<p>高速CAN，总线回归隐性电平快，传输速度就会快，低速CAN总线回归隐性电平慢，传输速度就会慢。</p>
<h1 id="can收发器tja1050高速can">
<a class="header-anchor" href="#can%e6%94%b6%e5%8f%91%e5%99%a8tja1050%e9%ab%98%e9%80%9fcan"></a>
CAN收发器（TJA1050，高速CAN）
</h1><ul>
<li>
<p>接收端</p>
<p>如果CANH和CANL之间有电压差，则Receiver就输出1，否则就输出0</p>
<p>当Receiver输出为1时，上管断开，下管导通，输出0。输出为0时，上管导通，下管断开，输出1。RXD为输入部分</p>
</li>
<li>
<p>发送端通过两个三级管来控制输出的电压差，当TXD为0时，上面的三极管将CANH线的电平拉高，下面的三极管将CANL线的电平拉低，出现电压差，显示为0</p>
</li>
</ul>
<p>其中的两个电阻为中拉电阻，通过两个电阻，可以将CANH和CANL两根线都拉到0.5倍VCC的中间电平，使CANH和CANL的默认对地电压都是2.5v左右，同时，这两个电阻还有一定的收紧作用，但是由于阻值较大，所以收紧电压一般都使用外部的电阻来实现 。</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_52_56_202501150952460.png" alt="CAN收发器电路"></p>
<h1 id="can物理层">
<a class="header-anchor" href="#can%e7%89%a9%e7%90%86%e5%b1%82"></a>
CAN物理层
</h1><p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/15_9_55_48_202501150955650.png" alt="CAN物理层"></p>
<h1 id="can总线帧格式">
<a class="header-anchor" href="#can%e6%80%bb%e7%ba%bf%e5%b8%a7%e6%a0%bc%e5%bc%8f"></a>
CAN总线帧格式
</h1><p>CAN协议规定了以下5种类型的帧：</p>
<table>
  <thead>
      <tr>
          <th><strong>帧类型</strong></th>
          <th><strong>用途</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>数据帧</td>
          <td>发送设备主动发送数据（广播式）</td>
      </tr>
      <tr>
          <td>遥控帧</td>
          <td>接收设备主动请求数据（请求式）</td>
      </tr>
      <tr>
          <td>错误帧</td>
          <td>某个设备检测出错误时向其他设备通知错误</td>
      </tr>
      <tr>
          <td>过载帧</td>
          <td>接收设备通知其尚未做好接收准备</td>
      </tr>
      <tr>
          <td>帧间隔</td>
          <td>用于将数据帧及遥控帧与前面的帧分离开</td>
      </tr>
  </tbody>
</table>
<h2 id="数据帧">
<a class="header-anchor" href="#%e6%95%b0%e6%8d%ae%e5%b8%a7"></a>
数据帧
</h2><p>灰色方块表示只能发送0，白的方块表示只能发送1，紫色的方块表示既能发送0也能发送1。其中的数字为位数。</p>
<ul>
<li>标准格式</li>
</ul>
<p>​	在发送数据之前，总线必须要为空闲状态，空闲状态时，总线是隐性电平（1），当开始发送数据帧时，首位必须要为显性电平0（SOF）。随后是报文ID，一般为11位。之后发送RTR，RTR必须要为0，用于区分数据帧（0）还是遥控帧（1）。后面按照图片进行控制。</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/06/28_14_49_19_202406281449257.png" alt="image-20240628144919152"></p>
<h2 id="数据帧的各部分用途简介">
<a class="header-anchor" href="#%e6%95%b0%e6%8d%ae%e5%b8%a7%e7%9a%84%e5%90%84%e9%83%a8%e5%88%86%e7%94%a8%e9%80%94%e7%ae%80%e4%bb%8b"></a>
数据帧的各部分用途简介
</h2><ul>
<li>SOF（Start of Frame）：帧起始，表示后面一段波形为传输的数据位</li>
<li>ID（Identify）：标识符，区分功能，同时决定优先级</li>
<li>RTR（Remote Transmission Request ）：远程请求位，区分数据帧和遥控帧</li>
<li>IDE（Identifier Extension）：扩展标志位，区分标准格式和扩展格式，标准格式为0，扩展格式为1</li>
<li>SRR（Substitute Remote Request）：替代RTR，协议升级时留下的无意义位</li>
<li>r0/r1（Reserve）：保留位，为后续协议升级留下空间</li>
<li>DLC（Data Length Code）：数据长度，指示数据段有几个字节</li>
<li>Data：数据段的1~8个字节有效数据</li>
<li>CRC（Cyclic Redundancy Check）：循环冗余校验，校验数据是否正确</li>
<li>ACK（Acknowledgement）：应答位，判断数据有没有被接收方接收</li>
<li>CRC/ACK界定符：为应答位前后发送方和接收方释放总线留下时间</li>
<li>EOF（End of Frame ）：帧结束，表示数据位已经传输完毕</li>
</ul>
<h2 id="遥控帧">
<a class="header-anchor" href="#%e9%81%a5%e6%8e%a7%e5%b8%a7"></a>
遥控帧
</h2><p><strong>遥控帧无数据段，RTR为隐性电平1，其他部分与数据帧相同</strong></p>
<p>CAN总线的数据主要靠发送方自觉广播出来的，一般发送方会定一个周期，定时广播自己的数据，但如果发送方没有及时发送自己的数据，或者这个数据的使用频率太低了，广播太频繁了，用不到就会浪费总线资源，广播太慢了，偶尔有用的话，有不能及时拿到。此时就可以规定，发送方不要主动广播数据，而是设备有需要的话，首先接收方发出一个遥控帧，遥控帧包含报文ID，遥控帧也是通过广播出来的，每个设备都能收到遥控帧，如果其中某个设备有这个ID的数据，就会通过数据帧广播出来，这样接收方就可以及时获取这个数据了</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/06/28_16_7_17_202406281607091.png" alt="image-20240628160717000"></p>
<h2 id="错误帧">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e5%b8%a7"></a>
错误帧
</h2><p>总线上所有设备都会监督总线的数据，一旦发现“位错误”或“填充错误”或“CRC错误”或“格式错误”或“应答错误” ，这些设备便会发出错误帧来破坏数据，同时终止当前的发送设备</p>
<p>发现数据帧数据有错，所以破坏了该数据帧，是一种错误处理机制</p>
<ul>
<li>主动错误
<ul>
<li>发了6个0表示主动错误，中间有0到6位的延长时间，是错误标志的重叠部分。之后发送错误界定符，也就是8个1</li>
</ul>
</li>
<li>被动错误
<ul>
<li>发了6个1表示被动错误，之后发送错误界定符，也就是8个1</li>
</ul>
</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/06/28_16_5_38_202406281605204.png" alt="image-20240628160538120"></p>
<h2 id="过载帧">
<a class="header-anchor" href="#%e8%bf%87%e8%bd%bd%e5%b8%a7"></a>
过载帧
</h2><p>当接收方收到大量数据而无法处理时，其可以发出过载帧，延缓发送方的数据发送，以平衡总线负载，避免数据丢失</p>
<p><strong>发送方发送数据太快，接受方处理不了，由接收方产生</strong></p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/06/28_16_6_10_202406281606109.png" alt="image-20240628160610037"></p>
<h2 id="帧间隔">
<a class="header-anchor" href="#%e5%b8%a7%e9%97%b4%e9%9a%94"></a>
帧间隔
</h2><p>将数据帧和遥控帧与前面的帧分离开</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/06/28_16_6_44_202406281606889.png" alt="image-20240628160644796"></p>
<h1 id="位填充">
<a class="header-anchor" href="#%e4%bd%8d%e5%a1%ab%e5%85%85"></a>
位填充
</h1><p>位填充规则：发送方每发送5个相同电平后，自动追加一个相反电平的填充位，接收方检测到填充位时，会自动移除填充位，恢复原始数据</p>
<p>例如：</p>
<p>​     即将发送：     100000110     10000011110          0111111111110</p>
<p>​     实际发送：     100000<strong>1</strong>110   100000<strong>1</strong>1111<strong>0</strong>0     011111<strong>0</strong>11111<strong>0</strong>10</p>
<p>​     实际接收：     100000<strong>1</strong>110   100000<strong>1</strong>1111<strong>0</strong>0     011111<strong>0</strong>11111<strong>0</strong>10</p>
<p>​     移除填充后： 100000110     10000011110          0111111111110</p>
<p>位填充作用：</p>
<ul>
<li>增加波形的定时信息，利于接收方执行“再同步”，防止波形长时间无变化，导致接收方不能精确掌握数据采样时机</li>
<li>将正常数据流与“错误帧”和“过载帧”区分开，标志“错误帧”和“过载帧”的特异性</li>
<li>保持CAN总线在发送正常数据流时的活跃状态，防止被误认为总线空闲</li>
</ul>
<h1 id="接收方数据采样">
<a class="header-anchor" href="#%e6%8e%a5%e6%94%b6%e6%96%b9%e6%95%b0%e6%8d%ae%e9%87%87%e6%a0%b7"></a>
接收方数据采样
</h1><ul>
<li>CAN总线没有时钟线，总线上的所有设备通过约定波特率的方式确定每一个数据位的时长</li>
<li>发送方以约定的位时长每隔固定时间输出一个数据位</li>
<li>接收方以约定的位时长每隔固定时间采样总线的电平，输入一个数据位</li>
<li>理想状态下，接收方能依次采样到发送方发出的每个数据位，且采样点位于数据位中心附近</li>
</ul>
<h2 id="接收方数据采样遇到的问题">
<a class="header-anchor" href="#%e6%8e%a5%e6%94%b6%e6%96%b9%e6%95%b0%e6%8d%ae%e9%87%87%e6%a0%b7%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98"></a>
接收方数据采样遇到的问题
</h2><p>采样指的是对于数据的读取，使用固定时间间隔对数据进行采样。</p>
<ul>
<li>接收方以约定的位时长进行采样，但是采样点没有对齐数据位中心附近，假设每次采样的时候都会采到数据的跳变，这时就不知道采样采的是0还是1了</li>
<li>接收方刚开始采样正确，但是时钟有误差，随着误差积累，采样点逐渐偏离</li>
</ul>
<h1 id="位时序">
<a class="header-anchor" href="#%e4%bd%8d%e6%97%b6%e5%ba%8f"></a>
位时序
</h1><p>为了灵活调整每个采样点的位置，使采样点对齐数据位中心附近，CAN总线对<strong>每一个数据位的时长进行了更细的划分</strong>，分为同步段（SS）、传播时间段（PTS）、相位缓冲段1（PBS1）和相位缓冲段2（PBS2），每个段又由若干个最小时间单位（Tq，Time Quantum）构成</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_8_43_51_202407010843114.png" alt="image-20240701084350854"></p>
<p>其中，Tq的时间是自己指定的，如可以指定1Tq=0.5us</p>
<ul>
<li>SS段为同步段，如果数据跳变沿正好出现在SS段，则说明当前设备与波形达成同步，如果当前跳变沿不在SS段，则需要调整当前设备的位时序，使跳变沿正好出现在同步段，也就是采用硬同步和再同步手段，使得跳变沿再次出现在SS段</li>
<li>PTS段为传播时间段，PTS用于吸收网络上的物理延迟，网络的物理延迟指定发送单元的输出延迟，总线上信号的传播延迟、接收单元的输入延迟。PTS的时间为以上各延迟时间的和的两倍。控制器想发信号，由于硬件电路的限制，这个信号输出到总线，总会有延迟，所以设计该段。也就是说当开始发送数据时，SS结束后要稍微等一等，等待传播的延迟。</li>
<li>PBS1和PBS2为相位缓冲段，其作用为确定采样点的位置，<strong>采样点会在PBS1和PBS2中间</strong>，所以调节PBS1和PBS2的时间长短就可以条件采样位置</li>
</ul>
<h2 id="硬同步">
<a class="header-anchor" href="#%e7%a1%ac%e5%90%8c%e6%ad%a5"></a>
硬同步
</h2><ul>
<li>每个设备都有一个位时序计时周期，当某个设备（发送方）率先发送报文，其他所有设备（接收方）收到SOF的下降沿时，接收方会将自己的位时序计时周期拨到SS段的位置，与发送方的位时序计时周期保持同步</li>
<li>硬同步只在帧的第一个下降沿（SOF下降沿）有效</li>
<li>经过硬同步后，若发送方和接收方的时钟没有误差，则后续所有数据位的采样点必然都会对齐数据位中心附近</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_9_4_37_202407010904500.png" alt="image-20240701090437363"></p>
<h2 id="再同步">
<a class="header-anchor" href="#%e5%86%8d%e5%90%8c%e6%ad%a5"></a>
再同步
</h2><ul>
<li>若发送方或接收方的时钟有误差，随着误差积累，数据位边沿逐渐偏离SS段，则此时接收方根据再同步补偿宽度值（SJW）通过加长PBS1段，或缩短PBS2段，以调整同步</li>
<li>再同步可以发生在第一个下降沿之后的每个数据位跳变边沿</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_9_13_56_202407010913262.png" alt="image-20240701091356141"></p>
<p>上图是发送方信号沿快于SS，图中的红色部分就是SJW，下图是发送方信号沿慢于SS</p>
<p>硬同步用于一帧波形初始的位置对齐，所以硬同步更加激进一些，直接在波形边沿，把自己的秒表拨到SS段，一旦一帧波形开始，就不能再这么激进的调整同步了。所以再同步的补偿需要限定范围，一次只补偿一点，不能再多了</p>
<h2 id="波特率计算">
<a class="header-anchor" href="#%e6%b3%a2%e7%89%b9%e7%8e%87%e8%ae%a1%e7%ae%97"></a>
波特率计算
</h2>$$
波特率 = \frac {1} {一个数据位的时长} = \frac {1} {TSS + TPTS + TPBS1 + TPBS2}
$$<p>例如：
$$
SS = 1Tq，PTS = 3Tq，PBS1 = 3Tq，PBS2 = 3Tq \</p>
<p>Tq = 0.5us\</p>
<p>波特率 = \frac{1} {0.5us + 1.5us + 1.5us + 1.5us}=0.2 \times 10^6 bps= 200kbps
$$</p>
<h1 id="总线的资源分配规则">
<a class="header-anchor" href="#%e6%80%bb%e7%ba%bf%e7%9a%84%e8%b5%84%e6%ba%90%e5%88%86%e9%85%8d%e8%a7%84%e5%88%99"></a>
总线的资源分配规则
</h1><h2 id="多设备同时发送所遇到的问题">
<a class="header-anchor" href="#%e5%a4%9a%e8%ae%be%e5%a4%87%e5%90%8c%e6%97%b6%e5%8f%91%e9%80%81%e6%89%80%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98"></a>
多设备同时发送所遇到的问题
</h2><ul>
<li>CAN总线只有一对差分信号线，同一时间只能有一个设备操作总线发送数据，若多个设备同时有发送需求，该如何分配总线资源？</li>
<li>解决问题的思路：制定资源分配规则，依次满足多个设备的发送需求，确保同一时间只有一个设备操作总线</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_10_13_9_202407011013630.png" alt="image-20240701101309303"></p>
<p>现假设两个设备想要同时发送数据，有以下两种情况：</p>
<ol>
<li>一个波形正在发送，另外一个想要发送</li>
<li>多个波形在同一起始段都想要发送数据</li>
</ol>
<h2 id="问题1解决方案-先占先得">
<a class="header-anchor" href="#%e9%97%ae%e9%a2%981%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-%e5%85%88%e5%8d%a0%e5%85%88%e5%be%97"></a>
问题1解决方案-先占先得
</h2><ul>
<li>若当前已经有设备正在操作总线发送数据帧/遥控帧，则其他任何设备不能再同时发送数据帧/遥控帧（可以发送错误帧/过载帧破坏当前数据）</li>
<li>任何设备检测到连续11个隐性电平，即认为总线空闲，只有在总线空闲时，设备才能发送数据帧/遥控帧</li>
<li>一旦有设备正在发送数据帧/遥控帧，总线就会变为活跃状态，必然不会出现连续11个隐性电平，其他设备自然也不会破坏当前发送</li>
<li>若总线活跃状态其他设备有发送需求，则需要等待总线变为空闲，才能执行发送需求</li>
</ul>
<h2 id="问题2解决方案-非破坏性仲裁">
<a class="header-anchor" href="#%e9%97%ae%e9%a2%982%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-%e9%9d%9e%e7%a0%b4%e5%9d%8f%e6%80%a7%e4%bb%b2%e8%a3%81"></a>
问题2解决方案-非破坏性仲裁
</h2><ul>
<li>若多个设备的发送需求同时到来或因等待而同时到来，则CAN总线协议会根据ID号（仲裁段）进行非破坏性仲裁，ID号小的（优先级高）取到总线控制权，ID号大的（优先级低）仲裁失利后将转入接收状态，等待下一次总线空闲时再尝试发送</li>
<li>实现非破坏性仲裁需要两个要求：
<ul>
<li>线与特性：总线上任何一个设备发送显性电平0时，总线就会呈现显性电平0状态，只有当所有设备都发送隐性电平1时，总线才呈现隐性电平1状态，即：0 &amp; X &amp; X = 0，1 &amp; 1 &amp; 1 = 1</li>
<li>回读机制：每个设备发出一个数据位后，都会读回总线当前的电平状态，以确认自己发出的电平是否被真实的发送出去了，根据线与特性，发出0读回必然是0，发出1读回不一定是1</li>
</ul>
</li>
</ul>
<h3 id="非破坏性仲裁过程">
<a class="header-anchor" href="#%e9%9d%9e%e7%a0%b4%e5%9d%8f%e6%80%a7%e4%bb%b2%e8%a3%81%e8%bf%87%e7%a8%8b"></a>
非破坏性仲裁过程
</h3><p>数据位从前到后依次比较，出现差异且数据位为1的设备仲裁失利</p>
<p>单元1和单元2代表的是两个设备，根据线与特性，总线显示为空闲状态，所以此时单元1和单元2同时向总线发送请求，也就是同时发送SOF（0），两个单元同时回读，此时总线电平呈现0状态，单元1和单元2会继续同时向总线发送且回读，如果发送的和回读的不一样，代表仲裁失利，从下一位开始转为接收状态工作。</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_10_45_1_202407011045629.png" alt="image-20240701104501522"></p>
<h2 id="数据帧和遥控帧的优先级">
<a class="header-anchor" href="#%e6%95%b0%e6%8d%ae%e5%b8%a7%e5%92%8c%e9%81%a5%e6%8e%a7%e5%b8%a7%e7%9a%84%e4%bc%98%e5%85%88%e7%ba%a7"></a>
数据帧和遥控帧的优先级
</h2><p>数据帧和遥控帧ID号一样时，数据帧的优先级高于遥控帧</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_11_0_5_202407011100485.png" alt="image-20240701110005381"></p>
<h2 id="标准格式和扩展格式的优先级">
<a class="header-anchor" href="#%e6%a0%87%e5%87%86%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%89%a9%e5%b1%95%e6%a0%bc%e5%bc%8f%e7%9a%84%e4%bc%98%e5%85%88%e7%ba%a7"></a>
标准格式和扩展格式的优先级
</h2><p>标准格式的优先级高于扩展格式（SRR必须始终为1，以保证此要求）</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_11_1_53_202407011101180.png" alt="image-20240701110153070"></p>
<h1 id="错误处理">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86"></a>
错误处理
</h1><h2 id="错误类型">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e7%b1%bb%e5%9e%8b"></a>
错误类型
</h2><p>错误共有5种： 位错误、填充错误、CRC错误、格式错误、应答错误</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_13_29_1_202407011329954.png" alt="image-20240701132901833"></p>
<h2 id="错误状态">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e7%8a%b6%e6%80%81"></a>
错误状态
</h2><ul>
<li>每个设备内部管理一个TEC和REC，根据TEC和REC的值确定自己的状态</li>
<li>主动错误状态的设备正常参与通信并在检测到错误时发出主动错误标志</li>
<li>被动错误状态的设备正常参与通信但检测到错误时只能发出被动错误标志</li>
<li>总线关闭状态的设备不能参与通信</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_13_37_43_202407011337981.png" alt="image-20240701133743895"></p>
<h2 id="错误计数器">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e8%ae%a1%e6%95%b0%e5%99%a8"></a>
错误计数器
</h2><p>对于接收的错误较为宽容</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/1_13_45_2_202407011345704.png" alt="image-20240701134502590"></p>
<h1 id="can外设">
<a class="header-anchor" href="#can%e5%a4%96%e8%ae%be"></a>
CAN外设
</h1><h2 id="简介">
<a class="header-anchor" href="#%e7%ae%80%e4%bb%8b"></a>
简介
</h2><ul>
<li>STM32内置bxCAN外设（CAN控制器），支持CAN2.0A和2.0B，可以自动发送CAN报文和按照过滤器自动接收指定CAN报文，程序只需处理报文数据而无需关注总线的电平细节</li>
<li>波特率最高可达1兆位/秒</li>
<li>3个可配置优先级的发送邮箱</li>
<li>2个3级深度的接收FIFO</li>
<li>14个过滤器组（互联型28个）：用于过滤总线上不需要的报文（通过id）</li>
<li>时间触发通信、自动离线恢复、</li>
<li>自动唤醒、禁止自动重传、</li>
<li>接收FIFO溢出处理方式可配置、</li>
<li>发送优先级可配置、双CAN模式</li>
<li>STM32F103C8T6 CAN资源：CAN1</li>
</ul>
<h2 id="网络拓扑结构">
<a class="header-anchor" href="#%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91%e7%bb%93%e6%9e%84"></a>
网络拓扑结构
</h2><p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_14_58_50_202410171458168.png" alt="网络拓扑结构"></p>
<p>CAN的控制器在MCU中，而收发器在外部属于外设，CAN控制器将会引出两个引脚，CAN的发送和CAN的接收，CAN的收发器将会将收到的Rx或Tx的数据转换成差分数据，也就是这里的CAN High和CAN Low</p>
<p>CAN收发器原理图：</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_9_0_202410171509100.png" alt="收发器原理图"></p>
<p>对MCU端的接口为TX、RX、VCC和GND，对外接口为CANH和CANL</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_9_6_202410171509047.png" alt="收发器框图"></p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_9_23_202410171509675.png" alt="收发器实物图"></p>
<h2 id="内部设计">
<a class="header-anchor" href="#%e5%86%85%e9%83%a8%e8%ae%be%e8%ae%a1"></a>
内部设计
</h2><p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_17_47_202410171517789.png" alt="内部设计"></p>
<p>CAN2辅助CAN1工作，共同管理同一个CAN总线</p>
<p><em><code>主发送</code>邮箱</em>：每个邮箱存一个CAN报文，如果想要发出一个CAN报文，那就需要将这个报文写入道其中的一个空置邮箱中，之后设置寄存器请求发送就行了，其余的如位同步、仲裁等等都靠硬件电路自动实现就好</p>
<p><em><code>接受</code>滤波器</em>：当接收到一个报文时，首先需要经过接收过滤器，无论收到遥控帧还是远程帧，CAN硬件电路都会将该帧报文缓存下来，之后再传输进入过滤器。过滤器内可以设置过滤规则，告诉硬件想要指定的ID的报文</p>
<p><em><code>主接收</code>FIFO</em>：当一个报文通过过滤器时，就可以进入主接受FIFO（由邮箱组成）</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_35_43_202410171535157.png" alt="内部简化框图"></p>
<ol>
<li>
<p>MCU对外提供CAN_TX和CAN_RX，而引脚内部就需要配置相关的GPIO：</p>
<ul>
<li>
<p>CAN_TX是输出，引脚控制权在CAN外设，所以需要将引脚配置为复用推挽输出模式</p>
</li>
<li>
<p>CAN_RX是输入，可以配置为上拉输入</p>
</li>
</ul>
</li>
<li>
<p>从GPIO进入之后，将会由发送和接收控制器全权控制</p>
<ul>
<li>当我们想要发送数据时，只需要将需要发送的数据写入发送邮箱中，发送和接收控制器会自动帮我们发送报文。并且发送时，可以配置发送模式，比如按照发送ID的优先级发送或者按照FIFO模式发送</li>
<li>当我们想要接收数据时，发送和接收控制器会匹配过滤器，如果符合要求将会自动存入邮箱中，不需要人为的干涉</li>
</ul>
</li>
</ol>
<h2 id="基本过程">
<a class="header-anchor" href="#%e5%9f%ba%e6%9c%ac%e8%bf%87%e7%a8%8b"></a>
基本过程
</h2><h3 id="发送过程">
<a class="header-anchor" href="#%e5%8f%91%e9%80%81%e8%bf%87%e7%a8%8b"></a>
发送过程
</h3><p>邮箱有以下描述：</p>
<ul>
<li>RQCP：请求完成</li>
<li>TXOK：发送成功</li>
<li>TME：发送邮箱空</li>
<li>TXRQ：发送请求控制位</li>
<li>ABRQ：中止发送</li>
<li>NART：自动重传</li>
</ul>
<p>发送流程详述：</p>
<ol>
<li>空置状态下，等待被填充数据，当有一个发送请求时，将会转到挂号状态</li>
<li>挂号状态表示此邮箱的数据已准备好了，但是邮箱有三个，可能别的邮箱也有数据已经准备好了，所以该邮箱需要排队，如果邮箱已经时最高优先级了，那么就表明下一次发送就轮到该邮箱了，邮箱立马进入预定状态</li>
<li>在预定状态下，等待总线为空闲，如果为空闲，就正式进入发送状态</li>
<li>在正式发送状态时，成功则转到空置且发送成功状态，如果使用自动重传（NART=0）则返回预定状态，否则返回空置且发送未完成状态。</li>
</ol>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_15_50_34_202410171550332.png" alt="发送过程"></p>
<h3 id="接收过程">
<a class="header-anchor" href="#%e6%8e%a5%e6%94%b6%e8%bf%87%e7%a8%8b"></a>
接收过程
</h3><p>状态有以下描述：</p>
<ul>
<li>FMP：报文数量</li>
<li>FOVR：FIFO溢出</li>
<li>FULL：FIFO存满</li>
<li>RFOM：释放FIFO</li>
</ul>
<p>接收到一个报文→匹配过滤器后进入FIFO 0或FIFO 1→CPU读取</p>
<ol>
<li>在初始状态下，当收到有效报文时，进入挂号1状态，报文数量为1（0x01）</li>
<li>当进入挂号1状态时，收到有效报文，进入状态2，此时报文数量为2（0x02，==下图写错了==）</li>
<li>当进入挂号状态2时，收到有效报文，进入状态3，此时报文数量为3（0x03）</li>
<li>当进入挂号状态3时，收到有效报文，进入溢出状态，此时FIFO溢出标志位设为1</li>
<li>当读取数据时，就会释放邮箱，一级一级回到挂号及空状态</li>
</ol>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_16_4_32_202410171604208.png" alt="接收过程"></p>
<blockquote>
<p>[!NOTE]</p>
<p>发送和接收配置位：</p>
<ul>
<li>NART：置1，关闭自动重传，CAN报文只被发送1次，不管发送的结果如何（成功、出错或仲裁丢失）；置0，自动重传，CAN硬件在发送报文失败时会一直自动重传直到发送成功</li>
<li>TXFP：置1，优先级由发送请求的顺序来决定，先请求的先发送；置0，优先级由报文标识符来决定，标识符值小的先发送（标识符值相等时，邮箱号小的报文先发送）</li>
<li>RFLM：置1，接收FIFO锁定，FIFO溢出时，新收到的报文会被丢弃；置0，禁用FIFO锁定，FIFO溢出时，FIFO中最后收到的报文被新报文覆盖</li>
</ul></blockquote>
<h3 id="过滤器">
<a class="header-anchor" href="#%e8%bf%87%e6%bb%a4%e5%99%a8"></a>
过滤器
</h3><p>标识符过滤器：</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_16_15_18_202410171615690.png" alt="标识符过滤器"></p>
<p>==每个==过滤器的核心由两个32位寄存器组成：R1[31:0]和R2[31:0]</p>
<ul>
<li>
<p>FSCx：位宽设置，置0，16位；置1，32位</p>
</li>
<li>
<p>FBMx：模式设置，置0，屏蔽模式；置1，列表模式</p>
</li>
<li>
<p>FFAx：关联设置，置0，FIFO 0；置1，FIFO 1</p>
</li>
<li>
<p>FACTx：激活设置， 置0，禁用；置1，启用</p>
<blockquote>
<p>其中x可以为0-13</p></blockquote>
</li>
</ul>
<p>过滤的配置有：</p>
<ul>
<li>让指定ID通过（标识符列表）</li>
<li>让指定组ID（组ID有着相同的数据段）通过（标识符屏蔽）</li>
</ul>
<p>根据FSC和FBM两位的配置，过滤器可以工作在4中状态下：</p>
<ul>
<li>
<p>如果FSC=1，FBM=0，那么就工作在图中的第一行的状态下</p>
</li>
<li>
<p>如果FSC=1，FBM=1，那么就工作在图中的第二行的状态下</p>
</li>
<li>
<p>如果FSC=0，FBM=0，那么就工作在图中的第三行的状态下</p>
</li>
<li>
<p>如果FSC=0，FBM=1，那么就工作在图中的第四行的状态下</p>
</li>
</ul>
<blockquote>
<p>标识符列表模式：</p>
<blockquote>
<p>对于2个32位过滤器而言，用户可以写入两个目标ID，R1和R2中都包含数据</p>
<p>当收到一个报文时，就和R1和R2中的ID做比对，如果相同就通过过滤器，否则则舍弃</p>
<p>在存储映像中，32位寄存器的高11位存标准格式的ID号，后面的18位存的是拓展格式的ID号</p>
<p>如果想要区分拓展ID还是标准ID就需要看后面的IDE的数据位（置1为拓展ID，置0为标准ID）</p>
<p>如果想要区分遥控帧，就需要控制RTR位，RTR为是遥控帧标识位，写0就过滤数据帧，写1就过滤遥控帧</p></blockquote>
<blockquote>
<p>而对于4个16位过滤器而言，只过滤标准格式的ID就可以使用FSC=0，此时的长度为16位，那么一个过滤器就可以写入4个目标ID</p></blockquote></blockquote>
<blockquote>
<p>标识符屏蔽模式</p>
<blockquote>
<p>对于1个32过滤器而言，用户可以设置需要屏蔽的ID（R1）和相应的掩码（R2）</p>
<p>假设现在需求是过滤出以0x01开头的所有标准ID号</p>
<blockquote>
<p>那么ID号应该为001 xxxxxxx</p>
<p>在R1中就可以填001 00000（当然，后面是任意填的，不是0填充也行）</p>
<p>在掩码中，位为1表示必须匹配，位为0表示不需要匹配</p>
<p>那么为了解决需求，则需要给R2设置为111 00000000（高三位为1表示必须匹配，低位为0表示可以为任意数）</p></blockquote></blockquote></blockquote>
<p>过滤器示例：</p>
<table>
  <thead>
      <tr>
          <th>总线上存在的ID</th>
          <th>想要接收的ID</th>
          <th>过滤器模式</th>
          <th>R1[31:0]配置值</th>
          <th>R2[31:0]配置值</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0x123, 0x234, <!-- raw HTML omitted -->0x345, 0x456, <!-- raw HTML omitted -->0x567, 0x678</td>
          <td>0x234,  <!-- raw HTML omitted -->0x345, <!-- raw HTML omitted -->0x567</td>
          <td>16位/列表</td>
          <td>ID: R1[15:0]=0x234&laquo;5  <!-- raw HTML omitted -->ID: R1[31:16]=0x345&laquo;5</td>
          <td>ID: R2[15:0]=0x567&laquo;5  <!-- raw HTML omitted -->ID: R2[31:16]=0x000&laquo;5</td>
      </tr>
      <tr>
          <td>0x100<del>0x1FF,<!-- raw HTML omitted -->0x200</del>0x2FF, <!-- raw HTML omitted -->0x310<del>0x31F,  <!-- raw HTML omitted -->0x320</del>0x32F</td>
          <td>0x200<del>0x2FF, <!-- raw HTML omitted --> 0x320</del>0x32F</td>
          <td>16位/屏蔽</td>
          <td>ID: R1[15:0]=0x200&laquo;5  <!-- raw HTML omitted -->Mask: R1[31:16]=  (0x700&laquo;5)|0x10|0x8</td>
          <td>ID: R2[15:0]=0x320&laquo;5  <!-- raw HTML omitted -->Mask: R2[31:16]=  (0x7F0&laquo;5)|0x10|0x8</td>
      </tr>
      <tr>
          <td>0x123, 0x234,  <!-- raw HTML omitted --> 0x345, 0x456,<!-- raw HTML omitted --> 0x12345678,<!-- raw HTML omitted --> 0x0789ABCD</td>
          <td>0x123,  <!-- raw HTML omitted -->0x12345678</td>
          <td>32位/列表</td>
          <td>ID: R1[31:0]=  0x123&laquo;21</td>
          <td>ID: R2[31:0]=  (0x12345678&laquo;3)|0x4</td>
      </tr>
      <tr>
          <td>0x12345600~  0x123456FF,<!-- raw HTML omitted --> 0x0789AB00~  0x0789ABFF</td>
          <td>0x12345600~  <!-- raw HTML omitted -->0x123456FF</td>
          <td>32位/屏蔽</td>
          <td>ID: R1[31:0]=  (0x12345600&laquo;3)|0x4</td>
          <td>Mask: R2[31:0]=  (0x1FFFFF00&laquo;3)|0x4|0x2</td>
      </tr>
      <tr>
          <td>任意ID</td>
          <td>只要遥控帧</td>
          <td>32位/屏蔽</td>
          <td>ID: R1[31:0]=0x2</td>
          <td>Mask: R2[31:0]=0x2</td>
      </tr>
      <tr>
          <td>任意ID</td>
          <td>所有帧</td>
          <td>32位/屏蔽</td>
          <td>ID: R1[31:0]=随意</td>
          <td>Mask: R2[31:0]=0</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>[!NOTE]</p>
<p>注意：赋值语句默认是右对齐的，在配置过滤器时，低位是标志位，所以在进行赋值的时候需要进行左移操作，至于需要左移几位就需要看需要使用哪种报文格式了</p></blockquote>
<h2 id="测试模式">
<a class="header-anchor" href="#%e6%b5%8b%e8%af%95%e6%a8%a1%e5%bc%8f"></a>
测试模式
</h2><p>在测试模式下，发送和接收的线路在内部会进行变更</p>
<ol>
<li>
<p>静默模式：用于分析CAN总线的活动，不会对总线造成影响。发送端直接接到接收端，在这个模式下可以进行自发自收测试，还可以默默的监测CAN总线数据。</p>
<blockquote>
<p>如果只想看一下总线上有哪些报文，而不想输出任何电平，就可以使用静默模式</p></blockquote>
</li>
<li>
<p>环回模式：用于自测试，同时发送的报文可以在CAN_TX引脚上检测到。RX引脚直接断开，且自己发送的数据，自己也可以收回来</p>
</li>
<li>
<p>环回静默模式：用于热自测试，自测的同时不会影响CAN总线</p>
<blockquote>
<p>一般为了确保自己的硬件是没问题的，会使用环回静默模式，自己发送一个报文，看看自己能不能进行接收</p></blockquote>
</li>
</ol>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_18_53_37_202410171853147.png" alt="测试模式"></p>
<h2 id="工作模式">
<a class="header-anchor" href="#%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f"></a>
工作模式
</h2><ol>
<li>初始化模式：用于配置CAN外设，禁止报文的接收和发送</li>
<li>正常模式：配置CAN外设后进入正常模式，以便正常接收和发送报文</li>
<li>睡眠模式：低功耗，CAN外设时钟停止，可使用软件唤醒或者硬件自动唤醒</li>
<li>AWUM：置1，自动唤醒，一旦检测到CAN总线活动，硬件就自动清零SLEEP，唤醒CAN外设；置0，手动唤醒，软件清零SLEEP，唤醒CAN外设</li>
</ol>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_19_6_50_202410171906621.png" alt="工作模式"></p>
<p>工作状态寄存器描述：</p>
<ul>
<li>SLAK：睡眠确认状态位，置1后表示硬件已经确认进入睡眠模式了</li>
<li>INAK：初始化确认位，置0表示硬件目前没有进入初始化模式</li>
<li>SLEEP：置0后就是请求退出睡眠</li>
<li>INRQ：置1后表示请求进入初始化，置0表示请求退出初始化</li>
</ul>
<h2 id="位时间特性">
<a class="header-anchor" href="#%e4%bd%8d%e6%97%b6%e9%97%b4%e7%89%b9%e6%80%a7"></a>
位时间特性
</h2><p>正常的时间分段分为：</p>
<ol>
<li>同步段：SS=1Tq</li>
<li>时间段1：BS1=1~16Tq</li>
<li>时间段2：BS2=1~8Tq</li>
<li>SJW=1~4Tq</li>
</ol>
<blockquote>
<p>[!TIP]</p>
<p>注意：前面说过位时序的组成：由SS+PTS+PBS1+PBS2组成，采样点位于PBS1和PBS2之间</p>
<p>但是现在将PTS和PBS1合并叫BS1段，采样点位于BS1和BS2段之间</p></blockquote>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_19_16_54_202410171916567.png" alt="位时间特性"></p>
$$
波特率 =\frac{ APB1时钟频率} {分频系数 \times 一位的Tq数量}  \\= \frac{36MHz} {(BRP[9:0]+1) \times ((1 + (TS1[3:0]+1) + (TS2[2:0]+1)))}
$$<h2 id="中断">
<a class="header-anchor" href="#%e4%b8%ad%e6%96%ad"></a>
中断
</h2><ul>
<li>CAN外设占用4个专用的中断向量</li>
<li>发送中断：发送邮箱空时产生</li>
<li>FIFO 0中断：收到一个报文/FIFO 0满/FIFO 0溢出时产生</li>
<li>FIFO 1中断：收到一个报文/FIFO 1满/FIFO 1溢出时产生</li>
<li>状态改变错误中断：出错/唤醒/进入睡眠时产生</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_19_31_7_202410171931671.png" alt="中断"></p>
<h2 id="时间触发通信">
<a class="header-anchor" href="#%e6%97%b6%e9%97%b4%e8%a7%a6%e5%8f%91%e9%80%9a%e4%bf%a1"></a>
时间触发通信
</h2><ul>
<li>TTCM：置1，开启时间触发通信功能；置0，关闭时间触发通信功能</li>
<li>CAN外设内置一个16位的计数器，用于记录时间戳</li>
<li>TTCM置1后，该计数器在每个CAN位的时间自增一次，溢出后归零</li>
<li>每个发送邮箱和接收FIFO都有一个TIME[15:0]寄存器，发送帧SOF时，硬件捕获计数器值到发送邮箱的TIME寄存器，接收帧SOF时，硬件捕获计数器值到接收FIFO的TIME寄存器</li>
<li>发送邮箱可配置TGT位，捕获计数器值的同时，也把此值写入到数据帧数据段的最后两个字节，为了使用此功能，DLC必须设置为8</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_19_34_45_202410171934433.png" alt="时间触发通信"></p>
<h2 id="错误处理和离线恢复">
<a class="header-anchor" href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e5%92%8c%e7%a6%bb%e7%ba%bf%e6%81%a2%e5%a4%8d"></a>
错误处理和离线恢复
</h2><ul>
<li>TEC和REC根据错误的情况增加或减少</li>
<li>ABOM：置1，开启离线自动恢复，进入离线状态后，就自动开启恢复过程；置0，关闭离线自动恢复，软件必须先请求进入然后再退出初始化模式，随后恢复过程才被开启</li>
</ul>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/10/17_19_38_16_202410171938474.png" alt="错误处理和离线恢复"></p>

      
    </div>
    <footer class="article-footer">
      

      

      
        

<div class="share-wrapper">
  
    <a href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:1313/post/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/can/&amp;title=CAN&amp;desc=%20CAN%e7%ae%80%e4%bb%8b%20CAN%e6%80%bb%e7%ba%bf%ef%bc%88Controller%20Area%20Network%20Bus%ef%bc%89%e6%8e%a7%e5%88%b6%e5%99%a8%e5%b1%80%e5%9f%9f%e7%bd%91%e6%80%bb%e7%ba%bf%0aCAN%e6%80%bb%e7%ba%bf%e6%98%af%e7%94%b1BOSCH%e5%85%ac%e5%8f%b8%e5%bc%80%e5%8f%91%e7%9a%84%e4%b8%80%e7%a7%8d%e7%ae%80%e6%b4%81%e6%98%93%e7%94%a8%e3%80%81%e4%bc%a0%e8%be%93%e9%80%9f%e5%ba%a6%e5%bf%ab%e3%80%81%e6%98%93%e6%89%a9%e5%b1%95%e3%80%81%e5%8f%af%e9%9d%a0%e6%80%a7%e9%ab%98%e7%9a%84%e4%b8%b2%e8%a1%8c%e9%80%9a%e4%bf%a1%e6%80%bb%e7%ba%bf%ef%bc%8c%e5%b9%bf%e6%b3%9b%e5%ba%94%e7%94%a8%e4%ba%8e%e6%b1%bd%e8%bd%a6%e3%80%81%e5%b5%8c%e5%85%a5%e5%bc%8f%e3%80%81%e5%b7%a5%e4%b8%9a%e6%8e%a7%e5%88%b6%e7%ad%89%e9%a2%86%e5%9f%9f%0aCAN%e6%80%bb%e7%ba%bf%e7%89%b9%e5%be%81%ef%bc%9a%0a%e4%b8%a4%e6%a0%b9%e9%80%9a%e4%bf%a1%e7%ba%bf%ef%bc%88CAN_H%e3%80%81CAN_L%ef%bc%89%ef%bc%8c%e7%ba%bf%e8%b7%af%e5%b0%91%ef%bc%8c%e6%97%a0%e9%9c%80%e5%85%b1%e5%9c%b0%0a%e5%b7%ae%e5%88%86%e4%bf%a1%e5%8f%b7%e9%80%9a%e4%bf%a1%ef%bc%8c%e6%8a%97%e5%b9%b2%e6%89%b0%e8%83%bd%e5%8a%9b%e5%bc%ba%0a%e9%ab%98%e9%80%9fCAN%ef%bc%88ISO11898%ef%bc%89%ef%bc%9a125k~1Mbps,%20&amp;lt;40m%0a%e4%bd%8e%e9%80%9fCAN%ef%bc%88ISO11519%ef%bc%89%ef%bc%9a10k~125kbps,%20&amp;lt;1km%0a%e5%bc%82%e6%ad%a5%ef%bc%8c%e6%97%a0%e9%9c%80%e6%97%b6%e9%92%9f%e7%ba%bf%ef%bc%8c%e9%80%9a%e4%bf%a1%e9%80%9f%e7%8e%87%e7%94%b1%e8%ae%be%e5%a4%87%e5%90%84%e8%87%aa%e7%ba%a6%e5%ae%9a%0a%e5%8d%8a%e5%8f%8c%e5%b7%a5%ef%bc%8c%e5%8f%af%e6%8c%82%e8%bd%bd%e5%a4%9a%e8%ae%be%e5%a4%87%ef%bc%8c%e5%a4%9a%e8%ae%be%e5%a4%87%e5%90%8c%e6%97%b6%e5%8f%91%e9%80%81%e6%95%b0%e6%8d%ae%e6%97%b6%e9%80%9a%e8%bf%87%e4%bb%b2%e8%a3%81%e5%88%a4%e6%96%ad%e5%85%88%e5%90%8e%e9%a1%ba%e5%ba%8f%0a11%e4%bd%8d/29%e4%bd%8d%20%e2%80%a6&amp;source=http://localhost:1313/" target="_blank" rel="noopener noreferrer" title="CAN">
      <div class="share-icon icon icon-qq">
        
      </div>
    </a>
  
    <a href="javascript:;"  title="CAN">
      <div class="share-icon icon icon-weixin">
        
          <div id="share-weixin">
            <div class="share-weixin-dom">
              <div class="share-weixin-content">
                <img id="share-weixin-banner"> 
                <div id="share-weixin-title"></div>
                <div id="share-weixin-desc"></div>
              </div>
              <div class="share-weixin-qrcode">
                <div class="share-weixin-info">
                  <div id="share-weixin-author"></div>
                  <div id="share-weixin-theme">Powered By hugo-theme-reimu</div>
                </div>
                <img id="share-weixin-qr" >
              </div>
            </div>
            <div class="share-weixin-canvas"></div>
          </div>
        
      </div>
    </a>
  
</div>
      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/%e9%80%9a%e4%bf%a1%e5%8d%8f%e8%ae%ae"
        rel="tag"
        >通信协议</a
      >
    </li>
  
</ul>

    </footer>
  </div>
  
    
  <nav
    id="article-nav"
    data-aos="fade-up"
  >
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          <img
            data-src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/07/5_11_7_25_202407051107514.png"
            data-sizes="auto"
            alt="CANoe"
            class="lazyload"
          />
        
        <a href="http://localhost:1313/post/%E8%BD%AF%E4%BB%B6%E5%8F%8A%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/canoe/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            CANoe
          
        </h3>
      </div>
    

    
      <div class="article-nav-link-wrap article-nav-link-right">
        
          
          
            <img
              data-src="https://s.ipyimatong.com/yuancangip/ips/20230926155265128a333caea.jpeg"
              data-sizes="auto"
              alt="C&#43;&#43;"
              class="lazyload"
            />
          
        
        <a href="http://localhost:1313/post/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/c&#43;&#43;/"></a>
        <div class="article-nav-caption">后一篇</div>
        <h3 class="article-nav-title">
          
            C&#43;&#43;
          
        </h3>
      </div>
    
  </nav>


  
</article>










</section>
        </div>
        
        
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
      2020 -
      2025
      <span class="footer-info-sep rotate"></span>
      TrustMe
    </div>
    
      <div>
        基于&nbsp;<a
          href="https://gohugo.io/"
          target="_blank"
          >Hugo</a
        >&nbsp; Theme.<a
          href="https://github.com/D-Sketon/hugo-theme-reimu"
          target="_blank"
          >Reimu</a
        >
      </div>
    
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            59.8k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          05:12
        </span>
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >总访问量&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >总访客量&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar">
        <div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#数据帧">数据帧</a></li>
    <li><a href="#数据帧的各部分用途简介">数据帧的各部分用途简介</a></li>
    <li><a href="#遥控帧">遥控帧</a></li>
    <li><a href="#错误帧">错误帧</a></li>
    <li><a href="#过载帧">过载帧</a></li>
    <li><a href="#帧间隔">帧间隔</a></li>
  </ul>

  <ul>
    <li><a href="#接收方数据采样遇到的问题">接收方数据采样遇到的问题</a></li>
  </ul>

  <ul>
    <li><a href="#硬同步">硬同步</a></li>
    <li><a href="#再同步">再同步</a></li>
    <li><a href="#波特率计算">波特率计算</a></li>
  </ul>

  <ul>
    <li><a href="#多设备同时发送所遇到的问题">多设备同时发送所遇到的问题</a></li>
    <li><a href="#问题1解决方案-先占先得">问题1解决方案-先占先得</a></li>
    <li><a href="#问题2解决方案-非破坏性仲裁">问题2解决方案-非破坏性仲裁</a>
      <ul>
        <li><a href="#非破坏性仲裁过程">非破坏性仲裁过程</a></li>
      </ul>
    </li>
    <li><a href="#数据帧和遥控帧的优先级">数据帧和遥控帧的优先级</a></li>
    <li><a href="#标准格式和扩展格式的优先级">标准格式和扩展格式的优先级</a></li>
  </ul>

  <ul>
    <li><a href="#错误类型">错误类型</a></li>
    <li><a href="#错误状态">错误状态</a></li>
    <li><a href="#错误计数器">错误计数器</a></li>
  </ul>

  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#网络拓扑结构">网络拓扑结构</a></li>
    <li><a href="#内部设计">内部设计</a></li>
    <li><a href="#基本过程">基本过程</a>
      <ul>
        <li><a href="#发送过程">发送过程</a></li>
        <li><a href="#接收过程">接收过程</a></li>
        <li><a href="#过滤器">过滤器</a></li>
      </ul>
    </li>
    <li><a href="#测试模式">测试模式</a></li>
    <li><a href="#工作模式">工作模式</a></li>
    <li><a href="#位时间特性">位时间特性</a></li>
    <li><a href="#中断">中断</a></li>
    <li><a href="#时间触发通信">时间触发通信</a></li>
    <li><a href="#错误处理和离线恢复">错误处理和离线恢复</a></li>
  </ul>
</nav>
  </div>
</div>
      </div>
      <div class="sidebar-common-sidebar hidden">
        
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="TrustMe"
    class="lazyload"
  />
  <div class="sidebar-author-name">TrustMe</div>
  <div class="sidebar-description">你要信我啊</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    
    <div class="sidebar-state-number">60</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-bilibili sidebar-social-icon">
      <a
        href="https://space.bilibili.com/yourname"
        itemprop="url"
        target="_blank"
        aria-label="bilibili"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/youShouldTrustMe"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="首页"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe61b;
        
      </div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="归档"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe623;
        
      </div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="关于"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe621;
        
      </div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="友链"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe639;
        
      </div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>

      </div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="/js/main.js" ></script>
      



  





  
      
      <script src="/js/aos.js" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="/js/pjax_main.js" data-pjax></script>
      



  <script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "60WEPCQQJ9",
        apiKey: "b3a7464ce9c969570301e3e4287d752e",
        indexName: "",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": "搜索.....",
          "hits_empty": "未发现与 「${query}」相关内容",
          "hits_stats": "找到${hits}条结果（用时 ${time} ms）"
        }
      }
    };
  </script>
  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    defer
    
    
    
    integrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"
  ></script>


  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js"
    defer
    
    
    
    integrity="sha384-hHJCflT4KBLQyHfKO9vpstIcFKn/Y&#43;KHTORelMMEn7mOp2AVPp&#43;7fr03dLgZiV3J" crossorigin="anonymous"
  ></script>


  





  
      
      <script src="/js/algolia_search.js" ></script>
      




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js"
    
    
    
    
    integrity="sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv" crossorigin="anonymous"
  ></script>


<script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"#ff5252\",\"#ff7c7c\",\"#ffafaf\",\"#ffd0d0\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"#ff0000\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>





<script>
  function initLive2d() {
    live2d.init('https:\/\/fastly.jsdelivr.net\/gh\/D-Sketon\/plugin-live2d\/', {themeTipsPath: ""});
  }
</script> 

  
  
  
  
  
  
  <script
    src="https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/js/live2d-autoload.js"
    
    async
    
    onload="initLive2d()"
    
  ></script>






<div id="lazy-script">
  <div>
    
      
      
        
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "TrustMe",
          title: "CAN",
          url: "http:\/\/localhost:1313\/post\/%E5%B5%8C%E5%85%A5%E5%BC%8F\/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE\/can\/",
          description: " CAN简介 CAN总线（Controller Area Network Bus）控制器局域网总线\nCAN总线是由BOSCH公司开发的一种简洁易用、传输速度快、易扩展、可靠性高的串行通信总线，广泛应用于汽车、嵌入式、工业控制等领域\nCAN总线特征：\n两根通信线（CAN_H、CAN_L），线路少，无需共地\n差分信号通信，抗干扰能力强\n高速CAN（ISO11898）：125k~1Mbps, \u0026lt;40m\n低速CAN（ISO11519）：10k~125kbps, \u0026lt;1km\n异步，无需时钟线，通信速率由设备各自约定\n半双工，可挂载多设备，多设备同时发送数据时通过仲裁判断先后顺序\n11位\/29位 …",
          cover: "https:\/\/gitlab.com\/18355291538\/picture\/-\/raw\/main\/pictures\/2025\/01\/15_9_50_55_202501150950487.png",
        };
      </script>
    
    
    
      





  
      
      <script src="/js/insert_highlight.js" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












      
        

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/qrcode@1.4.4/build/qrcode.min.js"
    defer
    
    data-pjax
    
    integrity="sha384-0RsG1yo/crf/1Qc14sho26SXXOTngNCjgJw7fuvXBt9W/OChF/Ijx&#43;aUuBDqQwEk" crossorigin="anonymous"
  ></script>


        

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/html-to-image@1.11.11/dist/html-to-image.js"
    defer
    
    data-pjax
    
    integrity="sha384-UbfRVKN3/elS1r7JcK2FhmPP&#43;KlJ4CvYwbyYD7tH&#43;uTkbT9bNJr9eJeQ0FoFbAgz" crossorigin="anonymous"
  ></script>


      
    
    
  </div>
</div>




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    
    async
    
    
    integrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"
  ></script>





  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>


<script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script>




  </body>
</html>
