<!doctype html>
<html
  lang="zh-cn" 
  
    data-theme-mode="auto"
  
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  Map文件 | TrustMe
</title>
<meta
  name="description"
  content="你要信我啊"
/>










<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\",\"count\":50,\"enable\":false},\"fail\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"success\":\"复制成功(*^▽^*)\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":\"本文最后更新于 {time}，请注意文中内容可能已经发生变化。\"}}");
</script>











  
  
  
    
  

  
  
  
    
  

  
    

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />



  






 <link rel="stylesheet" href="/css/loader.css" />




  <meta property="og:type" content="website" />
  <meta property="og:title" content="Map文件 | TrustMe" />
  <meta
    property="og:description"
    content="你要信我啊"
  />
  <meta property="og:url" content="http://localhost:1313/post/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/map%E6%96%87%E4%BB%B6/" />
  <meta
    property="og:site_name"
    content="TruestMe&#39;s Blog"
  />
  <meta
    property="og:image"
    content="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/14_8_17_40_202501140817123.png"
  />
  <meta property="article:author" content="TrustMe" />
  <meta property="article:published_time" content="2025-03-01T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2025-03-01T00:00:00&#43;00:00" />
  
    <meta property="article:tag" content="基础知识" />
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/14_8_17_40_202501140817123.png" />
  
  
  
  
  




<link rel="shortcut icon" href="/favicon.ico">







 <link rel="stylesheet" href="/css/main.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />





  </head>
  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
          M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
          </svg>
        
      </div>
      <div class="loading-word">你要信我啊...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>


<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="/">首页</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="/archives">归档</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="/about">关于</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="/friend">友链</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
    <picture></picture>
      <img fetchpriority="high" src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/14_8_17_40_202501140817123.png" alt="Map文件">
    
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">Map文件</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <div id="content"
          
          class="sidebar-right"  >
          <aside id="sidebar">
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#archives-linked">Archives linked</a></li>
    <li><a href="#memory-configuration">Memory configuration</a></li>
    <li><a href="#linker-script-and-memory-map">Linker script and memory map</a></li>
  </ul>

  <ul>
    <li><a href="#基础概念">基础概念</a></li>
    <li><a href="#组成部分">组成部分</a>
      <ul>
        <li><a href="#程序段交叉引用关系section-cross-references">程序段交叉引用关系（Section Cross References）</a></li>
        <li><a href="#删除映像未使用的程序段removingunused-input-sections-from-the-image">删除映像未使用的程序段（RemovingUnused input sections from the image）</a></li>
        <li><a href="#向映像中添加跳转代码adding-veneers-to-the-image"><strong>向映像中添加跳转代码</strong>(Adding Veneers to the image)</a></li>
        <li><a href="#映像符号表imagesymbol-table">映像符号表（ImageSymbol Table）</a></li>
        <li><a href="#映像内存分布图memorymap-of-the-image">映像内存分布图（MemoryMap of the image）</a></li>
        <li><a href="#映像组件大小imagecomponent-sizes">映像组件大小（Imagecomponent sizes）</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="TrustMe"
    class="lazyload"
  />
  <div class="sidebar-author-name">TrustMe</div>
  <div class="sidebar-description">你要信我啊</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    
    <div class="sidebar-state-number">59</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="首页"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="归档"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="关于"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="友链"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>

        </div>
      

      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  <div class="sidebar-widget">
    
  </div>
</aside>

          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <span
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2025-03-01 00:00:00 &#43;0000 UTC" itemprop="datePublished"
      >2025-03-01</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-03-01</time
    >
  </span>
</div>

      <div class="article-category">
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="参考链接">
<a class="header-anchor" href="#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5"></a>
参考链接
</h1><p><a href="http://www.openedv.com/thread-305913-1-1.html">KEIL MDK .map文件分析(必学知识点) - 正点原子倾力打造！-OpenEdv-开源电子网</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/502051758">充分理解Linux GCC 链接生成的Map文件 - 知乎 (zhihu.com)</a></p>
<blockquote>
<p>[!important]</p>
<p>可以使用AMAP可视化map文件</p></blockquote>
<h1 id="gcc平台">
<a class="header-anchor" href="#gcc%e5%b9%b3%e5%8f%b0"></a>
GCC平台
</h1><h2 id="archives-linked">
<a class="header-anchor" href="#archives-linked"></a>
Archives linked
</h2><p>一般位于map文件的第一行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> Archive member included to satisfy reference by file (symbol)
</span></span><span class="line"><span class="cl">    /usr/local/Cellar/arm-none-eabi-gcc/8-2018-q4-major/gcc/bin/../lib/gcc/arm-none-eabi/8.2.1/../../../../arm-none-eabi/lib/thumb/v7e-m+fp/hard/libc_nano.a(lib_a-exit.o)
</span></span><span class="line"><span class="cl">                                  /usr/local/Cellar/arm-none-eabi-gcc/8-2018-q4-major/gcc/bin/../lib/gcc/arm-none-eabi/8.2.1/../../../../arm-none-eabi/lib/thumb/v7e-m+fp/hard/crt0.o (exit)
</span></span></code></pre></div><p>上面的文件信息格式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">The archive file location (compilation unit)
</span></span><span class="line"><span class="cl">    			The compilation unit referencing the archive (symbol called)
</span></span></code></pre></div><p>上面内容的意思是crt0这个文件中会调用exit函数，exit函数在exit.o这个目标文件中，exit.o目标文件是被链接在libc_nano.a这个库文件里的。</p>
<h2 id="memory-configuration">
<a class="header-anchor" href="#memory-configuration"></a>
Memory configuration
</h2><p>Map文件中最直接的信息是实际的内存区域，这些区域具有位置、大小和访问权限:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Memory Configuration
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    Name             Origin             Length             Attributes
</span></span><span class="line"><span class="cl">    FLASH            0x0000000000001000 0x00000000000ff000 xr
</span></span><span class="line"><span class="cl">    RAM              0x0000000020000008 0x000000000003fff8 xrw
</span></span><span class="line"><span class="cl">    *default*        0x0000000000000000 0xffffffffffffffff
</span></span></code></pre></div><h2 id="linker-script-and-memory-map">
<a class="header-anchor" href="#linker-script-and-memory-map"></a>
Linker script and memory map
</h2><p>内存配置之后是Linker script and memory map，它给出了程序中符号的详细信息。一般来说，该段首先指示<code>text</code>区域的大小及其内容(<code>text</code>是编译的代码，而<code>data</code>是程序数据)。</p>
<p>在这里，中断向量(在.isr_vector下)出现在可执行文件的开头，定义在gcc_startup_nrf52840.S中:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Linker script and memory map
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    .text           0x0000000000001000      0x8c8
</span></span><span class="line"><span class="cl">     ***(.isr_vector)**
</span></span><span class="line"><span class="cl">     .isr_vector    0x0000000000001000      0x200 _build/nrf52840_xxaa/**gcc_startup_nrf52840.S.o**
</span></span><span class="line"><span class="cl">                    0x0000000000001000                __isr_vector
</span></span><span class="line"><span class="cl">     *(.text*)
</span></span><span class="line"><span class="cl">     .text          0x0000000000001200       0x40 /usr/local/Cellar/arm-none-eabi-gcc/8-2018-q4-major/gcc/bin/../lib/gcc/arm-none-eabi/8.2.1/thumb/v7e-m+fp/hard/crtbegin.o
</span></span><span class="line"><span class="cl">     .text          0x0000000000001240       0x74 /usr/local/Cellar/arm-none-eabi-gcc/8-2018-q4-major/gcc/bin/../lib/gcc/arm-none-eabi/8.2.1/../../../../arm-none-eabi/lib/thumb/v7e-m+fp/hard/crt0.o
</span></span><span class="line"><span class="cl">                    0x0000000000001240                _mainCRTStartup
</span></span><span class="line"><span class="cl">                    0x0000000000001240                _start
</span></span><span class="line"><span class="cl">     .text          0x00000000000012b4       0x3c _build/nrf52840_xxaa/gcc_startup_nrf52840.S.o
</span></span><span class="line"><span class="cl">                    0x00000000000012b4                Reset_Handler
</span></span><span class="line"><span class="cl">                    0x00000000000012dc                NMI_Handler
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    [...]
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">     .text.**bsp_board_led_invert**
</span></span><span class="line"><span class="cl">                    0x00000000000012f0       **0x34** _build/nrf52840_xxaa/**boards.c.o**
</span></span><span class="line"><span class="cl">                    0x00000000000012f0                bsp_board_led_invert
</span></span></code></pre></div><p>这些行给出了每个函数的地址和大小。在上面，你可以读取bsp_board_led_invert的地址，它来自boards.c.o(如你所猜测的，board.c的编译单元)，在<code>text</code>区域中它的大小为0x34字节。这样，我们就可以定位程序中使用的每个函数。</p>
<p>我的常量字符串_delay_ms_str在程序初始化时显然包含在程序中，只读数据作为rodata保存在链接器脚本中指定的FLASH区域中(存储在Flash中，而不是复制在RAM中，因为它是常量)。我可以在这行下面找到:</p>
<h1 id="mdk平台">
<a class="header-anchor" href="#mdk%e5%b9%b3%e5%8f%b0"></a>
MDK平台
</h1><p>.map文件是编译器链接时生成的一个文件，它主要包含了交叉链接信息。通过.map文件，我们可以知道整个工程的函数调用关系、FLASH和RAM占用情况及其详细汇总信息，能具体到单个源文件（.c/.s）的占用情况，根据这些信息，我们可以对代码进行优化。</p>
<p>.map文件可以分为以下5个组成部分：</p>
<ol>
<li>程序段交叉引用关系（Section Cross References）</li>
<li>删除映像未使用的程序段（Removing Unused input sections from the image）</li>
<li>映像符号表（Image Symbol Table）</li>
<li>映像内存分布图（Memory Map of the image）</li>
<li>映像组件大小（Image component sizes）</li>
</ol>
<h2 id="基础概念">
<a class="header-anchor" href="#%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5"></a>
基础概念
</h2><p>为了更好的分析map文件，我们先对需要用到的一些基础概念进行一个简单介绍，相关概念如下：</p>
<ul>
<li>Section：描述映像文件的代码或数据块，我们简称程序段</li>
<li>RO：Read Only的缩写，包括只读数据（RO data）和代码（RO code）两部分内容，占用FLASH空间</li>
<li>RW：Read Write的缩写，包含可读写数据（RW data，有初值，且不为0），占用FLASH（存储初值）和RAM（读写操作）</li>
<li>ZI：Zero initialized的缩写，包含初始化为0的数据（ZI data），占用RAM空间。</li>
<li>.text：相当于RO code</li>
<li>.constdata：相当于RO data</li>
<li>.bss：相当于ZI data</li>
<li>.data：相当于RW data</li>
</ul>
<h2 id="组成部分">
<a class="header-anchor" href="#%e7%bb%84%e6%88%90%e9%83%a8%e5%88%86"></a>
组成部分
</h2><h3 id="程序段交叉引用关系section-cross-references">
<a class="header-anchor" href="#%e7%a8%8b%e5%ba%8f%e6%ae%b5%e4%ba%a4%e5%8f%89%e5%bc%95%e7%94%a8%e5%85%b3%e7%b3%bbsection-cross-references"></a>
程序段交叉引用关系（Section Cross References）
</h3><p>这部分内容描述了各个文件（.c/.s等）之间函数（程序段）的调用关系：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Section Cross References
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ble_simple_peripheral.o(i.app_gap_evt_cb) refers to os_timer.o(i.os_timer_start) for os_timer_start
</span></span><span class="line"><span class="cl">    ble_simple_peripheral.o(i.app_gap_evt_cb) refers to gap_api.o(i.gap_start_advertising) for gap_start_advertising
</span></span><span class="line"><span class="cl">    ble_simple_peripheral.o(i.app_gap_evt_cb) refers to gap_api.o(i.gap_get_connect_num) for gap_get_connect_num
</span></span><span class="line"><span class="cl">    ble_simple_peripheral.o(i.app_gap_evt_cb) refers to os_timer.o(i.os_timer_stop) for os_timer_stop
</span></span></code></pre></div><p>上述描述段中，<code> ble_simple_peripheral.o(i.app_gap_evt_cb) refers to os_timer.o(i.os_timer_stop) for os_timer_stop</code>表示：ble_simple_peripheral.c文件中的app_gap_evt_cb函数调用了os_timer.c中的os_timer_stop函数。其中：i.app_gap_evt_cb表示app_gap_evt_cb函数的入口地址，同理i.os_timer_stop表示os_timer_stop的入口地址。</p>
<h3 id="删除映像未使用的程序段removingunused-input-sections-from-the-image">
<a class="header-anchor" href="#%e5%88%a0%e9%99%a4%e6%98%a0%e5%83%8f%e6%9c%aa%e4%bd%bf%e7%94%a8%e7%9a%84%e7%a8%8b%e5%ba%8f%e6%ae%b5removingunused-input-sections-from-the-image"></a>
删除映像未使用的程序段（RemovingUnused input sections from the image）
</h3><p>这部分内容描述了工程中由于未被调用而被删除的冗余程序段（函数/数据)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Removing Unused input sections from the image.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Removing ble_simple_peripheral.o(.rev16_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing ble_simple_peripheral.o(.revsh_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing ble_simple_peripheral.o(.rrx_text), (6 bytes).
</span></span><span class="line"><span class="cl">    Removing proj_main.o(.rev16_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing proj_main.o(.revsh_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing proj_main.o(.rrx_text), (6 bytes).
</span></span><span class="line"><span class="cl">    Removing driver_efuse.o(.rev16_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing driver_efuse.o(.revsh_text), (4 bytes).
</span></span><span class="line"><span class="cl">    Removing driver_efuse.o(.rrx_text), (6 bytes).
</span></span><span class="line"><span class="cl">    Removing driver_efuse.o(i.efuse_get_chip_unique_id_new), (182 bytes).
</span></span><span class="line"><span class="cl">    Removing driver_efuse.o(i.efuse_write), (40 bytes).
</span></span><span class="line"><span class="cl">    ......
</span></span><span class="line"><span class="cl">    Removing dmul.o(.text), (228 bytes).
</span></span><span class="line"><span class="cl">    Removing dfixul.o(.text), (48 bytes).
</span></span><span class="line"><span class="cl">    Removing cdrcmple.o(.text), (48 bytes).
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1183 unused section(s) (total 85261 bytes) removed from the image.
</span></span></code></pre></div><p>上面片段中，列出了所有被移除的程序段，比如driver_efuse.c里面的efuse_write函数就被移除了，因为该例程没用到delay_us函数。</p>
<p>另外，在最后还有一个统计信息：1183 unused section(s) (total 85261 bytes) removed from the image.表示总共移除了1183 个程序段（函数/数据），大小为85261字节。即给我们的MCU节省了85261字节的程序空间。</p>
<blockquote>
<p>[!note]</p>
<p>为了更好的节省空间，我们一般在MDK魔术棒C/C++选项卡里面勾选：One ELF Section per Function</p></blockquote>
<h3 id="向映像中添加跳转代码adding-veneers-to-the-image">
<a class="header-anchor" href="#%e5%90%91%e6%98%a0%e5%83%8f%e4%b8%ad%e6%b7%bb%e5%8a%a0%e8%b7%b3%e8%bd%ac%e4%bb%a3%e7%a0%81adding-veneers-to-the-image"></a>
<strong>向映像中添加跳转代码</strong>(Adding Veneers to the image)
</h3><p>在嵌入式系统开发中，特别是在使用ARM架构的微控制器时，<code>veneer</code>（翻译为“贴面”或“桥接”）是一种用于处理函数调用的机制。它通常用于处理跨不同内存区域（如从Thumb代码调用ARM代码，或从非安全代码调用安全代码）的函数调用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Adding Veneers to the image
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Adding TT veneer (10 bytes, Long) for call to &#39;ke_state_set&#39; from app_proj_event.o(i.app_act_created_ind_func).
</span></span><span class="line"><span class="cl">    Adding TT veneer (10 bytes, Long) for call to &#39;srand&#39; from app_proj_event.o(i.app_db_init_complete_ind_func).
</span></span><span class="line"><span class="cl">    Adding TT veneer (10 bytes, Long) for call to &#39;co_printf&#39; from ble_simple_peripheral.o(i.app_gap_evt_cb).
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    Adding TT veneer (10 bytes, Long) for call to &#39;mesh_fatal_error_report&#39; from m_al_scan.o(ram_code).
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">146 Veneer(s) (total 1460 bytes) added to the image.
</span></span></code></pre></div><p>在上面的代码段中，<code>ke_state_set</code>：从<code>app_proj_event.o</code>中的<code>app_act_created_ind_func</code>函数调用<code>ke_state_set</code>时，链接器添加了一个<code>veneer</code>。</p>
<h3 id="映像符号表imagesymbol-table">
<a class="header-anchor" href="#%e6%98%a0%e5%83%8f%e7%ac%a6%e5%8f%b7%e8%a1%a8imagesymbol-table"></a>
映像符号表（ImageSymbol Table）
</h3><p>映像符号表（Image Symbol Table）描述了被引用的各个符号（程序段/数据）在存储器中的存储地址、类型、大小等信息。映像符号表分为两类：</p>
<ol>
<li>本地符号（Local Symbols）</li>
<li>全局符号（Global Symbols）。</li>
</ol>
<h4 id="本地符号local-symbols">
<a class="header-anchor" href="#%e6%9c%ac%e5%9c%b0%e7%ac%a6%e5%8f%b7local-symbols"></a>
本地符号（Local Symbols）
</h4><p>​    本地符号（Local Symbols）记录了用static声明的全局变量地址和大小，c文件中函数的地址和用static声明的函数代码大小，汇编文件中的标号地址（作用域：限本文件)：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Image Symbol Table
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Local Symbols
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Symbol Name                              Value     Ov Type        Size  Object(Section)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ../clib/microlib/division.c              0x00000000   Number         0  uldiv.o ABSOLUTE
</span></span><span class="line"><span class="cl">    ../clib/microlib/division.c              0x00000000   Number         0  uidiv.o ABSOLUTE
</span></span><span class="line"><span class="cl">    ../clib/microlib/longlong.c              0x00000000   Number         0  llshl.o ABSOLUTE
</span></span><span class="line"><span class="cl">    ../clib/microlib/longlong.c              0x00000000   Number         0  llushr.o ABSOLUTE
</span></span><span class="line"><span class="cl">    ../clib/microlib/longlong.c              0x00000000   Number         0  llsshr.o ABSOLUTE
</span></span><span class="line"><span class="cl">    i.gatt_clr_peer_svc                      0x01009ff4   Section        0  gatt_api.o(i.gatt_clr_peer_svc)
</span></span><span class="line"><span class="cl">    gatt_clr_peer_svc                        0x01009ff5   Thumb Code    58  gatt_api.o(i.gatt_clr_peer_svc)
</span></span></code></pre></div><p>上述片段中，表示gatt_api.c文件中的gatt_clr_peer_svc函数的入口地址为：0x01009ff4，类型为：Section（程序段），大小为0。因为：i.gatt_clr_peer_svc仅仅表示gatt_clr_peer_svc函数入口地址，并不是指令，所以没有大小。在全局符号段，会列出gatt_clr_peer_svc函数的大小。</p>
<h4 id="全局符号global-symbols">
<a class="header-anchor" href="#%e5%85%a8%e5%b1%80%e7%ac%a6%e5%8f%b7global-symbols"></a>
全局符号（Global Symbols）
</h4><p>全局符号（Global Symbols）记录了全局变量的地址和大小，C文件中函数的地址及其代码大小，汇编文件中的标号地址（作用域：全工程）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Global</span> <span class="n">Symbols</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Symbol</span> <span class="n">Name</span>                              <span class="n">Value</span>     <span class="n">Ov</span> <span class="n">Type</span>        <span class="n">Size</span>  <span class="ne">Object</span><span class="p">(</span><span class="n">Section</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">BuildAttributes</span><span class="o">$$</span><span class="n">THM_ISAv4</span><span class="o">$</span><span class="n">P</span><span class="o">$</span><span class="n">D</span><span class="o">$</span><span class="n">K</span><span class="o">$</span><span class="n">B</span><span class="o">$</span><span class="n">S</span><span class="o">$</span><span class="n">PE</span><span class="o">$</span><span class="n">A</span><span class="p">:</span><span class="n">L22UL41UL21</span><span class="o">$</span><span class="n">X</span><span class="p">:</span><span class="n">L11</span><span class="o">$</span><span class="n">S22US41US21</span><span class="o">$</span><span class="n">IEEE1</span><span class="o">$</span><span class="n">IW</span><span class="o">$</span><span class="n">USESV6</span><span class="o">$~</span><span class="n">STKCKD</span><span class="o">$</span><span class="n">USESV7</span><span class="o">$~</span><span class="n">SHL</span><span class="o">$</span><span class="n">OTIME</span><span class="o">$</span><span class="n">ROPI</span><span class="o">$</span><span class="n">EBA8</span><span class="o">$</span><span class="n">MICROLIB</span><span class="o">$</span><span class="n">REQ8</span><span class="o">$</span><span class="n">PRES8</span><span class="o">$</span><span class="n">EABIv2</span> <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">anon</span><span class="o">$$</span><span class="n">obj</span><span class="o">.</span><span class="n">o</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">__ARM_use_no_argv</span>                        <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">syscall</span><span class="o">.</span><span class="n">txt</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">__Vectors</span>                                <span class="mh">0x00000000</span>   <span class="n">Data</span>           <span class="mi">0</span>  <span class="n">syscall</span><span class="o">.</span><span class="n">txt</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">_printf_a</span>                                <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">stubs</span><span class="o">.</span><span class="n">o</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">_printf_c</span>                                <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">stubs</span><span class="o">.</span><span class="n">o</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">_printf_charcount</span>                        <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">stubs</span><span class="o">.</span><span class="n">o</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="n">_printf_d</span>                                <span class="mh">0x00000000</span>   <span class="n">Number</span>         <span class="mi">0</span>  <span class="n">stubs</span><span class="o">.</span><span class="n">o</span> <span class="n">ABSOLUTE</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">adc_set_ref_voltage</span>                      <span class="mh">0x010008d1</span>   <span class="n">Thumb</span> <span class="n">Code</span>     <span class="mi">2</span>  <span class="n">driver_pmu</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">adc_set_ref_voltage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_act_created_ind_func</span>                 <span class="mh">0x010008d5</span>   <span class="n">Thumb</span> <span class="n">Code</span>    <span class="mi">66</span>  <span class="n">app_proj_event</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">app_act_created_ind_func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_act_deleted_ind_func</span>                 <span class="mh">0x0100091d</span>   <span class="n">Thumb</span> <span class="n">Code</span>    <span class="mi">30</span>  <span class="n">app_proj_event</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">app_act_deleted_ind_func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_addr_resolve_result_ind_func</span>         <span class="mh">0x01000941</span>   <span class="n">Thumb</span> <span class="n">Code</span>    <span class="mi">28</span>  <span class="n">app_proj_event</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">app_addr_resolve_result_ind_func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_adv_complete_ind_func</span>                <span class="mh">0x01000961</span>   <span class="n">Thumb</span> <span class="n">Code</span>    <span class="mi">48</span>  <span class="n">app_proj_event</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">app_adv_complete_ind_func</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_adv_report_ind_func</span>                  <span class="mh">0x01000995</span>   <span class="n">Thumb</span> <span class="n">Code</span>   <span class="mi">160</span>  <span class="n">app_proj_event</span><span class="o">.</span><span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">app_adv_report_ind_func</span><span class="p">)</span>
</span></span></code></pre></div><p><code> app_act_created_ind_func   0x010008d5   Thumb Code  66  app_proj_event.o(i.app_act_created_ind_func)</code>表示app_proj_event.c文件中的app_act_created_ind_func函数的入口地址为：0x010008d5，类型为：Thumb Code（程序段），大小为66字节。</p>
<blockquote>
<p>[!note]</p>
<p>注意，全局符号的地址和局部符号的地址不符，假如全局符号用的0x0800046D，那么局部符号就用0x0800046C，这是因为ARM规定Thumb指令级的所有指令，其最低位必须为1，0x0800046D=0x0800046C+1，所以才会有2个不同的地址，且总是差1，实际上就是同一个函数。</p></blockquote>
<h3 id="映像内存分布图memorymap-of-the-image">
<a class="header-anchor" href="#%e6%98%a0%e5%83%8f%e5%86%85%e5%ad%98%e5%88%86%e5%b8%83%e5%9b%bememorymap-of-the-image"></a>
映像内存分布图（MemoryMap of the image）
</h3><p>映像文件分为加载域（Load Region）和运行域（Execution Region），一个加载域必须有至少一个运行域（可以有多个运行域），而一个程序又可以有多个加载域。加载域为映像程序的实际存储区域，而运行域则是MCU上电后的运行状态。加载域和运行域的简化关系（这里仅表示一个加载域的情况）如下图所示：</p>
<p><img src="https://gitlab.com/18355291538/picture/-/raw/main/pictures/2025/01/14_8_17_40_202501140817123.png" alt="加载域和运行域的关系"></p>
<p>由图可知，RW区也是存放在ROM（FLASH）里面的，在执行main函数之前，RW（有初值且不为0的变量）数据会被拷贝到RAM区，同时还会在RAM里面创建ZI区（初始化为0的变量）。</p>
<p>映像内存分布如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Memory Map of the image
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Image Entry point : 0x01000f3d
</span></span></code></pre></div><p>上述片段表示映像的入口地址，也就是整个程序运行的起始地址，为：0x01000f3d。实际地址为：0x01000f3c（Thumb指令最低位是1）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  Load Region ROM (Base: 0x01000000, Size: 0x000184cc, Max: 0x00030000, ABSOLUTE)
</span></span></code></pre></div><p>上述片段表示ROM加载域，其起始地址为：0x01000000；占用大小为：0x000184cc；最大地址范围为：0x00030000。其内部包含两个运行域：ER_TABLE和ER_RO（由下述片段可以看出）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">   Execution Region ER_TABLE (Exec base: 0x01000000, Load base: 0x01000000, Size: 0x0000005c, Max: 0xffffffff, ABSOLUTE)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Exec Addr    Load Addr    Size         Type   Attr    Idx    E Section Name        Object
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    0x01000000   0x01000000   0x00000004   Data   RO       1542    jump_table_0        fr8010h_stack.lib(jump_table.o)
</span></span><span class="line"><span class="cl">    0x01000004   0x01000004   0x00000008   Data   RO       127    jump_table_1        proj_main.o
</span></span><span class="line"><span class="cl">    0x0100000c   0x0100000c   0x0000000c   Data   RO       1543    jump_table_2        fr8010h_stack.lib(jump_table.o)
</span></span><span class="line"><span class="cl">    0x01000018   0x01000018   0x00000004   Data   RO       128    jump_table_3        proj_main.o
</span></span><span class="line"><span class="cl">    0x0100001c   0x0100001c   0x00000040   Data   RO       1544    jump_table_4        fr8010h_stack.lib(jump_table.o)
</span></span></code></pre></div><p>上述片段表示ER_TABLE运行域，其起始地址为：0x01000000；占用大小为：0x0000005c；最大地址范围为：0xffffffff；即内部FLASH运行域，所有需要放内部FLASH的代码，都应该放到这个运行域里面。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    Execution Region ER_RO (Exec base: 0x0100005c, Load base: 0x0100005c, Size: 0x000156bc, Max: 0xffffffff, ABSOLUTE)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Exec Addr    Load Addr    Size         Type   Attr      Idx    E Section Name        Object
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    0x0100005c   0x0100005c   0x000000b0   Code   RO         5006    .text               mf_w.l(fadd.o)
</span></span><span class="line"><span class="cl">    0x0100010c   0x0100010c   0x00000064   Code   RO         5008    .text               mf_w.l(fmul.o)
</span></span><span class="line"><span class="cl">    0x01000170   0x01000170   0x0000007c   Code   RO         5010    .text               mf_w.l(fdiv.o)
</span></span><span class="line"><span class="cl">    0x010001ec   0x010001ec   0x0000014e   Code   RO         5012    .text               mf_w.l(dadd.o)
</span></span><span class="line"><span class="cl">    0x0100033a   0x0100033a   0x000000de   Code   RO         5014    .text               mf_w.l(ddiv.o)
</span></span><span class="line"><span class="cl">    0x01000418   0x01000418   0x00000026   Code   RO         5016    .text               mf_w.l(f2d.o)
</span></span><span class="line"><span class="cl">    0x0100043e   0x0100043e   0x00000038   Code   RO         5018    .text               mf_w.l(d2f.o)
</span></span><span class="line"><span class="cl">    0x01000476   0x01000476   0x0000001e   Code   RO         5024    .text               mc_w.l(llshl.o)
</span></span><span class="line"><span class="cl">    0x01000494   0x01000494   0x00000024   Code   RO         5026    .text               mc_w.l(llsshr.o)
</span></span><span class="line"><span class="cl">    0x010004b8   0x010004b8   0x00000000   Code   RO         5028    .text               mc_w.l(iusefp.o)
</span></span><span class="line"><span class="cl">    0x010004b8   0x010004b8   0x0000006e   Code   RO         5029    .text               mf_w.l(fepilogue.o)
</span></span><span class="line"><span class="cl">    0x01000526   0x01000526   0x000000ba   Code   RO         5031    .text               mf_w.l(depilogue.o)
</span></span><span class="line"><span class="cl">    0x010005e0   0x010005e0   0x00000020   Code   RO         5039    .text               mc_w.l(llushr.o)
</span></span></code></pre></div><p>上述片段表示ER_RO运行域，其起始地址为：0x0100005c；占用大小为：0x000156bc；最大地址范围为：0xffffffff；即内部SRAM运行域，所有RAM（包括RW和ZI）都是放在这个运行域里面。</p>
<p>上面只列举了部分加载域及其运行域的具体内存分布，我们可以很方便的查看任何一个函数所在的运行域、入口地址、占用空间等信息。</p>
<h3 id="映像组件大小imagecomponent-sizes">
<a class="header-anchor" href="#%e6%98%a0%e5%83%8f%e7%bb%84%e4%bb%b6%e5%a4%a7%e5%b0%8fimagecomponent-sizes"></a>
映像组件大小（Imagecomponent sizes）
</h3><p>映像组件大小（Image component sizes）给出了整个映像所有代码（.o）占用空间的汇总信息。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Image component sizes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      Code (inc. data)   RO Data    RW Data    ZI Data      Debug   Object Name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        96          8        128          0          0        576   app_boot_vectors.o
</span></span><span class="line"><span class="cl">       860        454         12         26         20      24402   ble_simple_peripheral.o
</span></span><span class="line"><span class="cl">        32          8          0         24         60       2298   button.o
</span></span><span class="line"><span class="cl">       100         60          0          0          0        590   core_cm3_isr.o
</span></span><span class="line"><span class="cl">       198          4          0          0          0       2340   driver_efuse.o
</span></span><span class="line"><span class="cl">        32         20          0          0          0       2843   driver_exti.o
</span></span><span class="line"><span class="cl">        48          4          0          4          0       3057   driver_i2s.o
</span></span><span class="line"><span class="cl">        32          0          0          0          0        622   driver_keyscan.o
</span></span><span class="line"><span class="cl">      1786         98          0          0          0       6985   driver_pmu.o
</span></span><span class="line"><span class="cl">        64         10          0          0          0       2194   driver_pmu_qdec.o
</span></span><span class="line"><span class="cl">         2          0          0          0          0        498   driver_rtc.o
</span></span><span class="line"><span class="cl">        92         12          0          0          0       2534   driver_timer.o
</span></span><span class="line"><span class="cl">       384        158          0          0          0       1809   driver_wdt.o
</span></span><span class="line"><span class="cl">      1116         52          0        256         24      30602   patch.o
</span></span><span class="line"><span class="cl">       276         36         12          0          0      12900   proj_main.o
</span></span><span class="line"><span class="cl">       556        210        591          4         12       4867   simple_gatt_service.o
</span></span><span class="line"><span class="cl">        96         38        489          2          0       2044   user_task.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span><span class="line"><span class="cl">      7236       1172       1236        332        116     101161   Object Totals
</span></span><span class="line"><span class="cl">      1460          0          0          0          0          0   (incl. Generated)
</span></span><span class="line"><span class="cl">         6          0          4         16          0          0   (incl. Padding)
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span></code></pre></div><p>上述片段表示.c/.s文件生成对象所占空间大小（单位：字节，下同），即.c/.s文件编译后所占代码空间的大小。每个项所代表的意义如下：</p>
<ul>
<li>Code（inc.data）：表示包含内联数据（inc.data）后的代码大小。如app_boot_vectors.o（即app_boot_vectors.c）所占的Code大小为576字节，其中 8 字节是内联数据。</li>
<li>RO Data：表示只读数据所占的空间大小，一般是指const修饰的数据大小。</li>
<li>RW Data：表示有初值（且非0）的可读写数据所占的空间大小，它同时占用FLASH和RAM空间。</li>
<li>ZI Data：表示初始化为0的可读写数据所占空间大小，它只占用RAM空间。</li>
<li>Debug：表示调试数据所占的空间大小，如调试输入节及符号和字符串。</li>
<li>Object Totals：表示以上部分链接到一起后，所占映像空间的大小。</li>
<li>(incl.Generated)：表示链接器生产的映像内容大小，它包含在Object Totals里面了，这里仅仅是单独列出，我们一般不需要关心。</li>
<li>(incl.Padding)：表示链接器根据需要插入填充以保证字节对齐的数据所占空间的大小，它也包含在Object Totals里面了，这里单独列出，一般无需关心。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">      Code (inc. data)   RO Data    RW Data    ZI Data      Debug   Library Member Name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      1368         44          0        102          0        480   adv_check_mode.o
</span></span><span class="line"><span class="cl">      2560        194          4         12        204       2212   app.o
</span></span><span class="line"><span class="cl">       432         56          0          8         20        296   app_conn.o
</span></span><span class="line"><span class="cl">        40          4          0          0          0         84   app_prf.o
</span></span><span class="line"><span class="cl">      1426        162          0          1          0       2140   app_proj_event.o
</span></span><span class="line"><span class="cl">      1546        244         56         16         82        952   app_sec.o
</span></span><span class="line"><span class="cl">      2308        188        228          9          0       2316   app_task.o
</span></span><span class="line"><span class="cl">      2482         22        112          0          0       1444   attc.o
</span></span><span class="line"><span class="cl">      1476         26          0          0          0        844   attm.o
</span></span><span class="line"><span class="cl">      1890         28          0          0          0        988   attm_db.o
</span></span><span class="line"><span class="cl">      4668         76        140          0          0       2656   atts.o
</span></span><span class="line"><span class="cl">      1782        206          0         16         40        576   entry.o
</span></span><span class="line"><span class="cl">       968         36         16          0          0        312   flash.o
</span></span><span class="line"><span class="cl">       ...
</span></span><span class="line"><span class="cl">       100          0          0          0          0         76   fmul.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span><span class="line"><span class="cl">     86908       4750       3124        696       3192      63128   Library Totals
</span></span><span class="line"><span class="cl">       128          0          7         11          2          0   (incl. Padding)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">     Code (inc. data)   RO Data    RW Data    ZI Data      Debug   Library Name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     85336       4750       3117        685       3190      61872   fr8010h_stack.lib
</span></span><span class="line"><span class="cl">        98          0          0          0          0        204   mc_w.l
</span></span><span class="line"><span class="cl">      1346          0          0          0          0       1052   mf_w.l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span><span class="line"><span class="cl">     86908       4750       3124        696       3192      63128   Library Totals
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ----------------------------------------------------------------------
</span></span></code></pre></div><p>上述片段表示被提取的库成员（.lib）添加到映像中的部分所占空间大小。各项意义同object中的说明。我们一般只用看LibraryTotals来分析库所占空间的大小即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">==============================================================================
</span></span><span class="line"><span class="cl">      Code (inc. data)   RO Data    RW Data    ZI Data      Debug   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     94144       5922       4360       1028       3308     123677   Grand Totals
</span></span><span class="line"><span class="cl">     94144       5922       4360       1028       3308     123677   ELF Image Totals
</span></span><span class="line"><span class="cl">     94144       5922       4360       1028          0          0   ROM Totals
</span></span><span class="line"><span class="cl">==============================================================================
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Total RO  Size (Code + RO Data)                98504 (  96.20kB)
</span></span><span class="line"><span class="cl">    Total RW  Size (RW Data + ZI Data)              4336 (   4.23kB)
</span></span><span class="line"><span class="cl">    Total ROM Size (Code + RO Data + RW Data)      99532 (  97.20kB)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">==============================================================================
</span></span></code></pre></div><p>上述片段表示本工程全部程序汇总后的占用情况。其中：</p>
<ul>
<li>Grand Totals：表示整个映像所占空间大小。</li>
<li>ELF Image Totals：表示ELF可执行链接格式映像文件的大小，一般和Grand Totals一样大小。</li>
<li>ROM Totals：表示整个映像所需要的ROM空间大小，不含ZI和Debug数据。</li>
<li>Total RO Size：表示Code和RO数据所占空间大小，本例程为：98504字节。</li>
<li>Total RW Size：表示RW和ZI数据所占空间大小，即本映像所需SRAM空间的大小，本例程为：4336字节。</li>
<li>Total ROM Size：表示Code、RO和RW数据所占空间大小，即本映像所需FLASH空间的大小，本例程为：99532字节。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      

      

      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86"
        rel="tag"
        >基础知识</a
      >
    </li>
  
</ul>

    </footer>
  </div>
  
    
  <nav
    id="article-nav"
    data-aos="fade-up"
  >
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img
              data-src="https://wallpaperm.cmcm.com/0feb1a932efcb5aa8c20423e777c277d.jpg"
              data-sizes="auto"
              alt="MarkDown"
              class="lazyload"
            />
          
        
        <a href="http://localhost:1313/post/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/markdown/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            MarkDown
          
        </h3>
      </div>
    

    
      <div class="article-nav-link-wrap article-nav-link-right">
        
          
          
            <img
              data-src="https://c-ssl.duitang.com/uploads/blog/202309/17/vDSABW1nsd89yv5.jpg"
              data-sizes="auto"
              alt="Makefile"
              class="lazyload"
            />
          
        
        <a href="http://localhost:1313/post/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/makefile/"></a>
        <div class="article-nav-caption">后一篇</div>
        <h3 class="article-nav-title">
          
            Makefile
          
        </h3>
      </div>
    
  </nav>


  
</article>










</section>
        </div>
        
        
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
      2020 -
      2025
      <span class="footer-info-sep rotate"></span>
      TrustMe
    </div>
    
      <div>
        基于&nbsp;<a
          href="https://gohugo.io/"
          target="_blank"
          >Hugo</a
        >&nbsp; Theme.<a
          href="https://github.com/D-Sketon/hugo-theme-reimu"
          target="_blank"
          >Reimu</a
        >
      </div>
    
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            58.9k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          05:07
        </span>
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >总访问量&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >总访客量&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar">
        <div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#archives-linked">Archives linked</a></li>
    <li><a href="#memory-configuration">Memory configuration</a></li>
    <li><a href="#linker-script-and-memory-map">Linker script and memory map</a></li>
  </ul>

  <ul>
    <li><a href="#基础概念">基础概念</a></li>
    <li><a href="#组成部分">组成部分</a>
      <ul>
        <li><a href="#程序段交叉引用关系section-cross-references">程序段交叉引用关系（Section Cross References）</a></li>
        <li><a href="#删除映像未使用的程序段removingunused-input-sections-from-the-image">删除映像未使用的程序段（RemovingUnused input sections from the image）</a></li>
        <li><a href="#向映像中添加跳转代码adding-veneers-to-the-image"><strong>向映像中添加跳转代码</strong>(Adding Veneers to the image)</a></li>
        <li><a href="#映像符号表imagesymbol-table">映像符号表（ImageSymbol Table）</a></li>
        <li><a href="#映像内存分布图memorymap-of-the-image">映像内存分布图（MemoryMap of the image）</a></li>
        <li><a href="#映像组件大小imagecomponent-sizes">映像组件大小（Imagecomponent sizes）</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
      </div>
      <div class="sidebar-common-sidebar hidden">
        
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="TrustMe"
    class="lazyload"
  />
  <div class="sidebar-author-name">TrustMe</div>
  <div class="sidebar-description">你要信我啊</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    
    <div class="sidebar-state-number">59</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="首页"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="归档"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/about"
        aria-label="关于"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/friend"
        aria-label="友链"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>

      </div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="/js/main.js" ></script>
      



  





  
      
      <script src="/js/aos.js" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="/js/pjax_main.js" data-pjax></script>
      



  <script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "",
        apiKey: "",
        indexName: "",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": "搜索.....",
          "hits_empty": "未发现与 「${query}」相关内容",
          "hits_stats": "找到${hits}条结果（用时 ${time} ms）"
        }
      }
    };
  </script>
  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    defer
    
    
    
    integrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"
  ></script>


  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js"
    defer
    
    
    
    integrity="sha384-hHJCflT4KBLQyHfKO9vpstIcFKn/Y&#43;KHTORelMMEn7mOp2AVPp&#43;7fr03dLgZiV3J" crossorigin="anonymous"
  ></script>


  





  
      
      <script src="/js/algolia_search.js" ></script>
      




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js"
    
    
    
    
    integrity="sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv" crossorigin="anonymous"
  ></script>


<script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"#ff5252\",\"#ff7c7c\",\"#ffafaf\",\"#ffd0d0\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"#ff0000\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>








<div id="lazy-script">
  <div>
    
      
      
        
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "TrustMe",
          title: "Map文件",
          url: "http:\/\/localhost:1313\/post\/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\/map%E6%96%87%E4%BB%B6\/",
          description: " 参考链接 KEIL MDK .map文件分析(必学知识点) - 正点原子倾力打造！-OpenEdv-开源电子网\n充分理解Linux GCC 链接生成的Map文件 - 知乎 (zhihu.com)\n[!important]\n可以使用AMAP可视化map文件\nGCC平台 Archives linked 一般位于map文件的第一行\nArchive member included to satisfy reference by file (symbol) …",
          cover: "https:\/\/gitlab.com\/18355291538\/picture\/-\/raw\/main\/pictures\/2025\/01\/14_8_17_40_202501140817123.png",
        };
      </script>
    
    
    
      





  
      
      <script src="/js/insert_highlight.js" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












      
    
    
  </div>
</div>




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    
    async
    
    
    integrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"
  ></script>





  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>


<script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script>




  </body>
</html>
